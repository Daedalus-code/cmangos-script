#!/bin/bash

# script >

############################################################################
#                      C M a N G O S  -  H E L P E R                       #
#               Continued Massive Network Game Object Server               #
############################################################################

# Built on a ubuntu system - Linux 5.4.0-1026-raspi - (Raspberry Pi4)
# https://ubuntu.com/download/raspberry-pi

# C(ontinued)-MaNGOS (Classic fork)

# By Rainman
# V20210202
# 4.6.5.7

# codes >
while :; do
  clear

  # config directory >
  # shellcheck disable=SC1091
  source /scripts/server.txt # please edit if wrong.

  # dialog, ncurses no utf8 acs >
  # ! -> https://github.com/scarygliders/X11RDP-o-Matic/issues/45
  export NCURSES_NO_UTF8_ACS=1

  # get database info
  if mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT SUM(online) FROM ${db_characters:?}.characters;" &>/dev/null; then
    menu_on_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT SUM(online) FROM ${db_characters:?}.characters;" 2>/dev/null)
  else
    menu_on_count=$(printf '%b' "\033[1;31m0\033[0m")
  fi
  if mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM ${db_characters:?}.guild;" &>/dev/null; then
    menu_gu_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM ${db_characters:?}.guild;" 2>/dev/null)
  else
    menu_gu_count=$(printf '%b' "\033[1;31m0\033[0m")
  fi

  # get date
  NOW="$(date +"%m.%d.%Y")"

  # get load
  load="$(while IFS= read -r i; do echo "${i%?}"; done </proc/loadavg 2>/dev/null | awk '{ print $1,$2,$3 }')"

  # service status
  world_service=mangosd
  realm_service=realmd

  # realmd service
  case "$(pidof $realm_service | wc -w)" in
  0) menu_realmd="realmd: [\033[1;31minactive\033[0m]" ;;
  1) menu_realmd="realmd: [\e[0;32mactive\033[0m]" ;;
  *) menu_realmd="realmd: [\e[0;33mrunning\033[0m]" ;;
  esac

  # mangosd service
  case "$(pidof $world_service | wc -w)" in
  0) menu_mangosd="mangosd: [\033[1;31minactive\033[0m]" ;;
  1) menu_mangosd="mangosd: [\e[0;32mactive\033[0m]" ;;
  *) menu_mangosd="mangosd: [\e[0;33mrunning\033[0m]" ;;
  esac
  # codes done

  # menu >

  printf "\033[0m ---------------------------------------------
    _____ _____     _____ _____ _____ _____
   |     |     |___|   | |   __|     |   __|
   |   --| | | | .'| | | |  |  |  |  |__   |\e[0;35m
   |_____|_|_|_|__,|_|___|_____|_____|_____|\n\e[0m"
  cat <<EOF
           C(ontinued)-MaNGOS Helper
             --------------------
EOF
  echo "               Online Players $menu_on_count"
  echo "                   Guilds $menu_gu_count"
  echo
  cat <<EOF
                $load

EOF

  # service status >

  printf '%b' "      $menu_mangosd $menu_realmd"
  echo

  # service status done

  cat <<EOF

       Start with checking for updates c)

   A : Login (command)      t : Characters
   a : Create account       u : Accounts
   c : Check for updates    g : Guilds
   m : Update CMaNGOS       e : Config
   d : Update Database      p : Patch
   w : Update Helper        o : Ping
   s : Shutdown server      l : Logs
   r : Restart server       Q : Quit

EOF
  read -r -n1 -s
  case "$REPLY" in

  # menu done

  "a")

    # codes >
    ac_count=$(mysql --defaults-extra-file="$sql_mycnf" -N --execute="SELECT count(*) FROM ${db_realmd:?}.account;" 2>/dev/null)
    bn_count=$(mysql --defaults-extra-file="$sql_mycnf" -N --execute="SELECT count(*) FROM $db_realmd.account_banned;" 2>/dev/null)
    # codes done

    clear

    # menu >

    printf '%b' "\033[0m ---------------------------------------------
\033[0m                                       __
   .---.-.----.----.-----.--.--.-----.|  |_
   |  _  |  __|  __|  _  |  |  |     ||   _|\e[0;35m
   |___._|____|____|_____|_____|__|__||____|
           \033[0mC(ontinued)-MaNGOS Helper
             \033[0m--------------------

                Accounts\e[0;32m...:\033[0m $ac_count
                Banned\e[0;32m.....:\033[0m $bn_count

                    \e[0;35mInfo:

           \e[0;32mSelect account operation\033[0m

              c : Create account
              d : Delete account

\033[0m ---------------------------------------------
             Press Any Key To Exit
>"

    read -r -n1 -s
    case "$REPLY" in

    # create account >

    "c")

      clear
      printf "\033[0m ---------------------------------------------

           \033[0m0: Vanilla\e[0;32m
           1: The Burning Crusade
           2: Wrath of the Lich King

           \033[0m0: Player\e[0;32m
           1: Moderator
           2: Game Master
           3: Administrator\033[0m

      Minimum 5 characters account name.

        Create new account (\e[0;35musername\033[0m)
        Set the (\e[0;35mexpansion\033[0m) version.
        Set the (\e[0;35maccount\033[0m) privilege.

        \e[0;35mExample\033[0m: 'username' '0' '0'
\033[0m ---------------------------------------------
             Press Any Key To Exit"

      # menu done

      # username, password, expansion, gmlevel >

      echo
      echo
      echo "Username"
      read -r USR
      if [[ -z "$USR" ]]; then
        printf "empty"
        echo
      else
        printf '%b' "[\e[0;32mok\033[0m] $USR"
        echo
        echo "Password"
        read -r -s PWD
        if [[ -z "$PWD" ]]; then
          printf "empty"
          echo
        else
          printf "[\e[0;32mok\033[0m] Password"
          echo
          echo "Expansion - 0"
          read -r -s XPV
          if [[ -z "$XPV" ]]; then
            printf "empty"
            echo
          else
            printf '%b' "[\e[0;32mok\033[0m] Expansion ($XPV)"
            echo
            echo "GMlevel - 0-3"
            read -r -s LVL
            if [[ -z "$LVL" ]]; then
              printf "empty"
              echo
            else
              printf '%b' "[\e[0;32mok\033[0m] GMlevel ($LVL)"
              echo "${user_nc:?}
${pass_nc:?}
.account create $USR $PWD
.account set addon $USR $XPV
.account set gmlevel $USR $LVL" >"${folder_wow:?}"/tmp.txt
              nc -q 1 "${host_nc:?}" "${port_nc:?}" <"${folder_wow:?}"/tmp.txt
              rm "${folder_wow:?}"/tmp.txt
              echo
              echo
              printf '%b' "[\e[0;32mok\033[0m] Account '\e[0;35m$USR\033[0m' ($XPV/$LVL) created."
              echo
              echo
            fi
          fi
        fi
      fi
      echo

      ;;

      # username, password, expansion, gmlevel done

      # create account done

      # delete account >

    "d")

      # codes >
      # check for backup >
      # realmd backup >
      FILE="$folder_wow/backup/$db_realmd-$NOW.sql"
      if [ ! -f "$FILE" ]; then
        realmd_backup="[\e[0;31mold\033[0m]"
        echo
      else
        realmd_backup="[\e[0;32mok\033[0m]"
        echo
      fi
      # characters backup >
      FILE="$folder_wow/backup/$db_characters-$NOW.sql"
      if [ ! -f "$FILE" ]; then
        charac_backup="[\e[0;31mold\033[0m]"
        echo
      else
        charac_backup="[\e[0;32mok\033[0m]"
        echo
      fi
      # codes done

      # menu >

      clear

      echo
      printf '%b' "\033[1;31m
 @@@@@@@  @@@@@@@@ @@@      @@@@@@@@ @@@@@@@ @@@@@@@@
 @@!  @@@ @@!      @@!      @@.        @@!   @@!
 @!@  !@! @!!!.:   @!!      @!!.:!     @!!   @!!!:.
 .!.  .!! !.:      !!.      .!:        !.:   !!.
 .: :  .  : .:  .. : .: : . . :. :.:    .    : .: .:.\033[0m

 Note: Make sure you have backup laying around!
 $realmd_backup$charac_backup

 Delete by id ->
 \e[0;35mExamples\033[0m: 'id' - 'id1,id2' - 'id1 AND id5'
 Delete by username ->
 \e[0;35mExamples\033[0m: 'username' - 'username1,username2'
 Select (\e[0;32musername\033[0m) or (\e[0;32mid\033[0m) - Press Enter To Confirm"

      echo
      echo
      read -r -p " Show list" </dev/tty
      echo
      mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT username, gmlevel, id FROM $db_realmd.account;"
      echo
      printf '%b' " Delete directly from '\e[0;35m$db_realmd.account\033[0m'"
      echo

      printf "
\033[0m ---------------------------------------------
             Press Any Key To Exit
>"
      read -r ID
      echo
      if [[ -z "$ID" ]]; then
        printf '%s\n' "empty"
      else
        deleted=$(printf '%b' "\e[91mDELETE\033[0m '$ID' \e[91m?!\033[0m")
        echo
        read -r -p "$deleted

Are You Sure? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # delete by id -> examples: ('id') (id1,id2,) & (id1 AND id5)
          mysql --defaults-extra-file="$sql_mycnf" --execute="DELETE FROM $db_realmd.account WHERE id = $ID;" &>/dev/null
          mysql --defaults-extra-file="$sql_mycnf" --execute="DELETE FROM $db_realmd.account WHERE id IN ($ID);" &>/dev/null
          mysql --defaults-extra-file="$sql_mycnf" --execute="DELETE FROM $db_realmd.account WHERE id BETWEEN $ID;" &>/dev/null
          # delete by username -> examples: ('username') & (username1,username2,)
          mysql --defaults-extra-file="$sql_mycnf" --execute="DELETE FROM $db_realmd.account WHERE username='$ID';" &>/dev/null
          mysql --defaults-extra-file="$sql_mycnf" --execute="DELETE FROM $db_realmd.account WHERE username IN ($ID);" &>/dev/null
          sleep 1
          echo
          echo " kek!"
          printf "(∩ ᐛ )⊃━━ "
          sleep 3
          printf "^\e[0;33m｡·.·\033[0mﾟ\e[0;33m★☆ﾟ.｡*\033[0m(つ﹏⊂)\e[0;33m?･ ｡★·"
          sleep 2
          printf ".\033[0m..poof!"
          sleep 1
          echo
          echo
          printf '%b' "$ID \033[0m..vanished!"
          sleep 1
          echo
          echo
        fi
      fi
      echo

      ;;

    *)
      echo "empty"
      echo
      ;;
    esac
    read -r -p "Press Enter to continue" </dev/tty
    echo

    ;;

    # menu done

    # delete account done

    # Login (command) >

    # * f★★ck; b7122@rd >> @ct1vlz1★n && chln@.

  "A")

    while :; do
      clear

      # codes >
      # service status
      world_service=mangosd
      realm_service=realmd

      # realmd service
      case "$(pidof $realm_service | wc -w)" in
      0) command_realmd="[\033[1;31moff\033[0m]" ;;
      1) command_realmd="[\e[0;32mok\033[0m]" ;;
      *) command_realmd="[\e[0;33mok\033[0m]" ;;
      esac

      # mangosd service
      case "$(pidof $world_service | wc -w)" in
      0) command_mangosd="[\033[1;31moff\033[0m]" ;;
      1) command_mangosd="[\e[0;32mok\033[0m]" ;;
      *) command_mangosd="[\e[0;33mok\033[0m]" ;;
      esac

      # Thank you! -> https://stackoverflow.com/questions/59862020

      # shellcheck disable=SC2034  # Unused variables left for readability
      # init_colors
      init_colors() {
        reset=$(tput sgr0)
        bold=$(tput bold)
        black=$(tput setaf 0)
        red=$(tput setaf 1)
        green=$(tput setaf 2)
        yellow=$(tput setaf 3)
        blue=$(tput setaf 4)
        magenta=$(tput setaf 5)
        cyan=$(tput setaf 6)
        white=$(tput setaf 7)
        user_color=$bold
      }

      # colorstring reads from stdin and uses parameter 1 as an escape sequence
      # with more parameters the first is used as a color, the other as the string to be modified
      # It will set colors until the last space sqquence
      colorstring() {
        case $# in
        0) # invalid
          echo "colorstring called without parameters"
          ;;
        1)
          sed -r "s/^.*[^ ]/$1&${reset}/"
          ;;
        *)
          color="$1"
          shift
          sed -r "s/^.*[^ ]/${color}&${reset}/" <<<"$@"
          ;;
        esac
      }
      dot_field() {
        # todo: Change implementation when field can be 2 words with a space in between
        printf "%-14.14s" "$1" | colorstring "${white}" | tr ' ' '.'
        # The : must be printed in a second statement when you don't want cyan dots.
        printf ':'
      }
      # todo: Change implementation when field can be 2 words with a space in between
      space_number() {
        printf "%-9.9s" "$1" | colorstring "${green}"
      }
      # todo: add logic when only 4 parameters are given
      printline() {
        echo "      $(dot_field "$1") $(space_number "$2")$(dot_field "$3") $(space_number "$4")$(dot_field "$5") $(space_number "$6")"
      }
      # init the color variables
      init_colors

      # uptime >
      cm_uptime="\033[0mTime""$W""$(uptime)\033[0m"

      # log data >

      # Realmd.log >

      # look for error
      if grep -E -q ".*ERROR*." "${folder_core:?}"/run/logs/Realmd.log &>/dev/null; then
        # if any, print "error"
        cm_realmd_log="[\033[0;31mError\033[0m]"
      else
        # if nothing, print "ok"
        cm_realmd_log="[\e[0;32mok\033[0m]"
      fi
      # look for empty tables
      if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log &>/dev/null; then
        # if any, print "empty"
        cm_realmd_log_empty="[\e[0;33mEmpty\033[0m]"
      fi
      # Realmd.log done

      # Server.log >

      # look for error
      if grep -E -q ".*ERROR*." "$folder_core"/run/logs/Server.log &>/dev/null; then
        # if any, print "error"
        cm_server_log="[\033[0;31mError\033[0m]"
      else
        # if nothing, print "ok"
        cm_server_log="[\e[0;32mok\033[0m]"
      fi
      # look for empty tables
      if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Server.log &>/dev/null; then
        # if any, print "empty"
        cm_server_log_empty="[\e[0;33mEmpty\033[0m]"
      fi
      # look for serious error
      if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log &>/dev/null; then
        # if any, print "serious"
        cm_server_log_serious="[\033[1;31mSerious\033[0m]"
      fi

      # Server.log done

      # check for backup >

      # realmd backup >
      FILE="$folder_wow/backup/$db_realmd-$NOW.sql"
      if [ ! -f "$FILE" ]; then
        realmd_backup="[\e[0;31mold\033[0m]"
        echo
      else
        realmd_backup="[\e[0;32mok\033[0m]"
        echo
      fi
      # characters backup >
      FILE="$folder_wow/backup/$db_characters-$NOW.sql"
      if [ ! -f "$FILE" ]; then
        charac_backup="[\e[0;31mold\033[0m]"
        echo
      else
        charac_backup="[\e[0;32mok\033[0m]"
        echo
      fi

      # world server latest build >
      if grep -q -o -a "\sBuilt\son\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "built date"
        latest_world_built=$(grep -o -a "\sBuilt\son\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null |
          sed 's/^ *//' 2>/dev/null)
      # if nothing, print "Restart server please.."
      else
        latest_world_built="\e[90mBuilt on Nov 23 2004 at 10:00:01\033[0m"
      fi
      # built for >
      if grep -q -o -a "\sBuilt\sfor\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "built for"
        built_for=$(grep -o -a "\sBuilt\sfor\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null |
          sed 's/^ *//' 2>/dev/null)
      # if nothing, print "Restart server please.."
      else
        built_for="\e[90mBuilt for Linux_x00 (next-to-nothing)\033[0m"
      fi
      # EventAI >
      if grep -q -o -a "\sACID\s1.12.x\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "EventAI"
        eventai=$(grep -o -a "\sACID\s1.12.x\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null |
          sed 's/^ *//' 2>/dev/null)
      # if nothing, print "Restart server please.."
      else
        eventai="\e[90mACID 0.00.x (Classic) for CMaNGOS-CLASSIC (0.00.X Client)\033[0m"
      fi
      # World DB >
      if grep -q -o -a "\s1.11\s*.*" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "World DB"
        world_db=$(grep -Eo "Classic DB version.*" "$folder_core"/run/logs/Server.log 2>/dev/null |
          sed 's/^ *//' 2>/dev/null)
      # if nothing, print "Restart server please.."
      else
        world_db="\e[90m0.00 'Into the Abyss of nothing.' For Classic core z0000.\033[0m"
      fi
      # cpu temp >
      if awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp &>/dev/null; then
        menu_cpu_temp=$(awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null |
          cut -c -4 2>/dev/null)
        menu_print_cpu_temp=$(printf '%b' "Temp\e[0;32m........:\033[0m ${menu_cpu_temp:?}c")
      else
        menu_print_cpu_temp=""
      fi
      # commit
      if grep -E "Using commit.*(.*)" "${folder_core:?}"/run/logs/Server.log &>/dev/null; then
        commit_hash=$(grep -E "Using commit.*(.*)" "${folder_core:?}"/run/logs/Server.log 2>/dev/null |
          grep -o "(.*)" 2>/dev/null | tr -d '()' 2>/dev/null | sed 's/^ *//' 2>/dev/null)
      else
        commit_hash="000000000000000000000000000000000000"
      fi
      # codes done

      printf '%b' "      $cm_uptime

      Realm\e[0;32m.......:\e[92m ${server_name:?}\033[0m
      $menu_print_cpu_temp
      World\e[0;32m.......:\033[0m $latest_world_built
      System\e[0;32m......:\033[0m $built_for
      Commit Hash\e[0;32m.:\e[90m $commit_hash\033[0m

      r : \e[0;35mLogin\033[0m   - Remote access  service.mangosd\e[0;32m.:\033[0m $command_mangosd
      l : \e[0;35mLogs\033[0m    - Analyze logs   service.realmd\e[0;32m..:\033[0m $command_realmd
      b : \e[0;35mBackup\033[0m  - New backup
      h : \e[0;35mReset\033[0m   - Reset --hard   characters.sql\e[0;32m..:\033[0m $charac_backup
      p : \e[0;35mhtop\033[0m    - Process view   realmd.sql\e[0;32m......:\033[0m $realmd_backup
      m : \e[0;35mMaps\033[0m    - Download maps
      w : \e[0;35mStats\033[0m   - World stats
      q : \e[0;35mQuit\033[0m    - Back to menu   Realmd.log\e[0;32m......:\033[0m $cm_realmd_log_empty$cm_realmd_log
      i : \e[0;35mInfo\033[0m    - Helper info    Server.log\e[0;32m......:\033[0m $cm_server_log_empty$cm_server_log$cm_server_log_serious
"
      echo
      read -r -s -n1
      case "$REPLY" in

      # Information >

      "i")

        clear
        printf '%b' "\033[0m
       _____     __  __       _   _  _____  ____   _____
      / ____|   |  \/  |     | \ | |/ ____|/ __ \ / ____|
     | |        | \  / |     |  \| | |  __  |  | | (___
     | |ontinued| |\/| | __ _| .   | | |_ | |  | |\___ \\
     | |____    | |  | |/ _  | |\  | |__| | |__| |____) |
      \_____|   |_|  |_| (_| |_| \_|\_____|\____/ \____/
      http://cmangos.net\__,_|     Doing things right!

      \e[0;32mC(ontinued)-MaNGOS (Classic fork)\033[0m

      EventAI\e[0;32m..:\033[0m $eventai
      World DB\e[0;32m.:\033[0m $world_db

      \e[0;35mhttps://github.com/cmangos/mangos-classic\033[0m
      \e[0;35mhttps://github.com/cmangos/classic-db\033[0m

      Tip: Use both in \e[0;35mrealmlist.wtf\033[0m

      \e[0;35mInternet\033[0m: 'set realmlist \e[0;90m${internet:?}\033[0m'
      \e[0;35mLanparty\033[0m: 'set realmlist \e[0;90m${intranet:?}\033[0m' - When internet drop out.

      Create another '\e[0;35m$db_realmd.realmlist\033[0m'\e[0;35m table row\033[0m, or just copy.
      Set new 'id', 'sameName (LAN)' and '\e[0;90m${intranet:?}\033[0m' as address.
      You can now choose 'Internet' or 'Lanparty' ingame from realm list.

      \033[0mIMPORTANT ! edit '\e[0;35mserver.txt\033[0m' & '\e[0;35mserver.cnf\033[0m' with correct info.

      'login' & 'create account' edit 'RA/NETCAT' inside \e[0;35mserver.txt.\033[0m
      'update Database' edit 'MYSQL' inside \e[0;35mserver.txt\033[0m, \e[0;35mserver.cnf\033[0m

      \e[0;32mC(ontinued)-MaNGOS - Helper\033[0m

      \e[0;35mhttps://github.com/Daedalus-code/cmangos-script\033[0m

      This script was built on a ubuntu system - (Raspberry Pi4)
      https://ubuntu.com/download/raspberry-pi

      Functions and features for admins running a WoW Vanilla server.

      Planned Features: Time will tell.

      ---What

      * Install this script on a ubuntu system, make everything more easy.
      * Connect to a MySQL server outside or localhost
      * Download latest core/database updates
      * Upgrade Database with latest fixes
      * Compile CMaNGOS with latest fixes
      * Download/Install classic maps
      * Profit

\e[1;32m>\033[0m hit Enter to go back.
\033[0m"
        echo
        read -r -p ">" </dev/tty

        ;;

        # Information done

        # seedbox menu >

      "m")

        # codes >
        if ! [ -x "$(command -v transmission-cli)" ]; then
          seed_transmission="[\e[0;33mnot installed\033[0m]"
        else
          transmission_list=$(transmission-remote -l 2>/dev/null)
          # transmission-daemon service >
          transmission_service=transmission-daemon
          # transmission-daemon status >
          case "$(pidof $transmission_service | wc -w)" in
          0) seed_transmission="[\033[1;31moff\033[0m]" ;;
          1) seed_transmission="[\e[0;32mok\033[0m]" ;;
          *) seed_transmission="[\e[0;33mok\033[0m]" ;;
          esac
        fi
        if ! [ -x "$(command -v transmission-cli)" ]; then
          intranet_seed=$(printf '%b' "[\e[0;33mnot installed\033[0m]" 2>/dev/null)
        else
          intranet_seed=$(printf '%b' "$intranet:9091" 2>/dev/null)
        fi
        # codes done

        # menu >

        clear
        echo
        echo
        printf '%b' "                    \e[0;32mCMaNGOS (Classic fork) - SeedBox for maps\e[31m

     \033[0m* Download/Upload maps for WoW Vanilla server.
     * This is an attempt to make classic maps available through p2p.
     * You can decide if you only want to download and stop transmission.

       Transmission\e[0;32m....:\033[0m $seed_transmission
       Web access\e[0;32m......:\033[0m $intranet_seed

       Default: download '\e[0;35munlimited\033[0m' upload '\e[0;35m128kb/s\033[0m'

 \e[0;32m<------------------------------------------------------------------------------>\033[0m
$transmission_list
 \e[0;32m<------------------------------------------------------------------------------>\033[0m

      t : \e[0;35mInstall seedbox\033[0m - Install transmission-daemon
      u : \e[0;35mRemove seedbox\033[0m  - Remove transmission-daemon
      r : \e[0;35mStart seedbox\033[0m   - Service transmission-daemon start
      s : \e[0;35mStop seedbox\033[0m    - Service transmission-daemon stop
      m : \e[0;35mInstall maps\033[0m    - Install vanilla.maps.zip

\e[1;32m>\033[0m hit Enter to go back.
\033[0m"
        echo
        printf '%b' ">"
        read -r -s -n1
        case "$REPLY" in

        # remove transmission-daemon >

        "u")

          echo
          read -r -p "Remove seedbox? (transmission-daemon) (y/n) " -n 1 -r
          echo
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then

            echo "Please wait"
            sudo apt-get remove transmission-daemon --purge -y &>/dev/null
          fi

          ;;

          # remove transmission-daemon done

          # setup seedbox (transmission) >
          # ubuntu

        "t")

          echo
          read -r -p "Setup seedbox? (transmission-daemon) (y/n) " -n 1 -r
          echo
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then

            # already installed? >
            if ! [ -x "$(command -v transmission-daemon)" ]; then
              # check for updates regardless >
              echo "Please wait"
              sudo apt-get update 2>/dev/null
              # make sure unzip exist >
              sudo apt-get install unzip -y 2>/dev/null
              # install transmission-daemon >
              sudo apt-get install transmission-daemon -y &>/dev/null
              # temporary stop ^ >
              sudo service transmission-daemon stop &>/dev/null
              # remove old config >
              sudo rm /var/lib/transmission-daemon/.config/transmission-daemon/settings.json &>/dev/null
              # create 'seedbox' directory >
              cd || exit
              sudo mkdir "/seedbox" &>/dev/null
              # fix folder owner >
              sudo chown -R debian-transmission:debian-transmission /seedbox/ &>/dev/null
              # setup transmission-daemon configuration file >
              # settings.json
              cat >"$folder_wow"/settings.json <<'EOF'
{
    "alt-speed-down": 50,
    "alt-speed-enabled": false,
    "alt-speed-time-begin": 540,
    "alt-speed-time-day": 127,
    "alt-speed-time-enabled": false,
    "alt-speed-time-end": 1020,
    "alt-speed-up": 50,
    "bind-address-ipv4": "0.0.0.0",
    "bind-address-ipv6": "::",
    "blocklist-enabled": true,
    "blocklist-url": "http://john.bitsurge.net/public/biglist.p2p.gz",
    "cache-size-mb": 16,
    "dht-enabled": true,
    "download-dir": "/seedbox",
    "download-queue-enabled": true,
    "download-queue-size": 5,
    "encryption": 1,
    "idle-seeding-limit": 30,
    "idle-seeding-limit-enabled": false,
    "incomplete-dir": "/seedbox",
    "incomplete-dir-enabled": false,
    "lpd-enabled": true,
    "message-level": 1,
    "peer-congestion-algorithm": "",
    "peer-id-ttl-hours": 6,
    "peer-limit-global": 100,
    "peer-limit-per-torrent": 50,
    "peer-port": 51413,
    "peer-port-random-high": 65535,
    "peer-port-random-low": 49152,
    "peer-port-random-on-start": false,
    "peer-socket-tos": "default",
    "pex-enabled": true,
    "port-forwarding-enabled": true,
    "preallocation": 1,
    "prefetch-enabled": true,
    "queue-stalled-enabled": true,
    "queue-stalled-minutes": 30,
    "ratio-limit": 2,
    "ratio-limit-enabled": false,
    "rename-partial-files": true,
    "rpc-authentication-required": false,
    "rpc-bind-address": "0.0.0.0",
    "rpc-enabled": true,
    "rpc-host-whitelist": "",
    "rpc-host-whitelist-enabled": false,
    "rpc-password": "{8cdc09d82992af11050cd6ca97c14f9117df07a1PiXvOluY",
    "rpc-port": 9091,
    "rpc-url": "/transmission/",
    "rpc-username": "mangos",
    "rpc-whitelist": "*.*.*.*",
    "rpc-whitelist-enabled": true,
    "scrape-paused-torrents-enabled": true,
    "script-torrent-done-enabled": false,
    "script-torrent-done-filename": "",
    "seed-queue-enabled": false,
    "seed-queue-size": 10,
    "speed-limit-down": 100,
    "speed-limit-down-enabled": false,
    "speed-limit-up": 128,
    "speed-limit-up-enabled": true,
    "start-added-torrents": true,
    "trash-original-torrent-files": false,
    "umask": 2,
    "upload-slots-per-torrent": 5,
    "utp-enabled": true
}
EOF
              # install to correct folder >
              sudo mv "$folder_wow"/settings.json /var/lib/transmission-daemon/.config/transmission-daemon/settings.json &>/dev/null
              sleep 1
              # start transmission-daemon >
              sudo service transmission-daemon start &>/dev/null
              echo
              printf '%b' "[\e[0;32mok\033[0m] - transmission should be running now"
              echo
              sleep 1
              # add magnet link: vanilla.maps.zip.torrent >
              transmission-remote -a "magnet:?xt=urn:btih:1cdcaa3d77a7f4df79935d885e639903e37dda24&dn=vanilla%5Fmaps.zip&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce" &>/dev/null
              echo
              printf '%b' "[\e[0;32mok\033[0m] - torrent added"
              echo
              sleep 1
              # reload >
              sudo systemctl daemon-reload 2>/dev/null
              sleep 1
            else
              printf '%b' "SeedBox already installed."
              echo
              sleep 2
            fi
          fi

          ;;

          # setup seedbox (transmission) done

          # start seedbox (transmission) >

        "r")

          echo
          read -r -p "Re/start seedbox? (transmission-daemon) (y/n) " -n 1 -r
          echo
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then

            echo "Please wait"
            sudo service transmission-daemon start &>/dev/null
            sleep 1
            # enable service >
            sudo systemctl enable transmission-daemon &>/dev/null
            # reload >
            sudo systemctl daemon-reload &>/dev/null
            echo
            printf '%b' "[\e[0;32mok\033[0m] - seedbox started."
            echo
            sleep 1
          fi

          ;;

          # start seedbox (transmission) done

          # stop seedbox (transmission) >

        "s")

          echo
          read -r -p "Stop seedbox? (transmission-daemon) (y/n) " -n 1 -r
          echo
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then

            echo "Please wait"
            sudo service transmission-daemon stop &>/dev/null
            sleep 1
            # disable service >
            sudo systemctl disable transmission-daemon &>/dev/null
            # reload >
            sudo systemctl daemon-reload &>/dev/null
            echo
            printf '%b' "[\033[1;31moff\033[0m] - seedbox stopped."
            echo
            sleep 1
          fi

          ;;

          # stop seedbox (transmission) done

          # install maps >

        "m")

          echo
          read -r -p "Install maps? (vanilla_maps.zip) (y/n) " -n 1 -r
          echo
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then

            # codes >
            MAPS="$folder_core"/run/maps/5332742.map
            MMAPS="$folder_core"/run/mmaps/5332742.mmtile
            VMAPS="$folder_core"/run/vmaps/Zulgurub_Ziggurat.wmo.vmo
            # codes done

            if [ -f "$MAPS" ] && [ -f "$MMAPS" ] && [ -f "$VMAPS" ]; then
              printf '%b' "Maps already installed."
              echo
              sleep 2
            else
              sudo unzip /seedbox/vanilla_maps.zip -d "$folder_core"/run
              echo
              printf '%b' "[\e[0;32mok\033[0m] - maps installed."
              echo
              sleep 1
            fi
          fi

          ;;

        esac

        ;;

        # install maps done

        # seedbox menu done

        # htop >

      "p")

        if ! [ -x "$(command -v htop)" ]; then
          echo "Please wait"
          sudo apt-get install htop -y 2>/dev/null
        fi
        htop

        ;;

        # htop done

        # reset --hard (everything) >

      "h")

        printf " \033[0;31mWARNING\033[0m: 'reset --hard' (\e[0;35meverything\033[0m) Are You Sure? (y/n)"
        echo
        read -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          echo
          echo
          printf "\e[0;35mmangos-classic\033[0m: "
          cd "$folder_core" || exit
          git reset --hard
          printf "\e[0;35mclassic-db\033[0m: "
          cd "${folder_db:?}" || exit
          git reset --hard
          printf "\e[0;35mcmangos-script\033[0m: "
          cd "${folder_helper:?}" || exit
          git reset --hard
          echo
          echo
          read -r -p "Press Enter to continue" </dev/tty
          echo
        fi

        ;;

        # reset --hard (everything) done

        # dive into logs >

      "l")

        # codes >
        # server.log.old >
        dive_server_old_empty=$(grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty.|.*empty*." "$folder_core"/run/logs/Server.log.old 2>/dev/null)
        dive_server_old_error=$(grep -c -E ".*ERROR*." "$folder_core"/run/logs/Server.log.old 2>/dev/null)
        dive_server_old_serio=$(grep -c -E "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log.old 2>/dev/null)
        dive_server_old_ignor=$(grep -c -E ".*ignoring*.|.*ignore*.|.*ignored*." "$folder_core"/run/logs/Server.log.old 2>/dev/null)
        # server.log >
        dive_server_empty=$(grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty.|.*empty*." "$folder_core"/run/logs/Server.log 2>/dev/null)
        dive_server_error=$(grep -c -E ".*ERROR*." "$folder_core"/run/logs/Server.log 2>/dev/null)
        dive_server_serio=$(grep -c -E "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log 2>/dev/null)
        dive_server_ignor=$(grep -c -E ".*ignoring*.|.*ignore*.|.*ignored*." "$folder_core"/run/logs/Server.log 2>/dev/null)
        # realmd.log >
        dive_realmd_empty=$(grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log 2>/dev/null)
        dive_realmd_error=$(grep -c -E ".*ERROR*." "$folder_core"/run/logs/Realmd.log 2>/dev/null)
        dive_realmd_serio=$(grep -c -E "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Realmd.log 2>/dev/null)
        # DBErrors.log >
        dive_DBError_corr=$(grep -c -E "does\snot\shave\scorresponding" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        dive_DBError_exis=$(grep -c -E "doesn't\sexist" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        dive_DBError_quer=$(grep -c -E "query\sERROR" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        dive_DBError_used=$(grep -c -E "Option\swill\snever\sbe\sused" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        dive_DBError_cras=$(grep -c -E "can\scrash\sclient" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        # char.log >
        dive_char_created=$(grep -c -E "Create\sCharacter" "$folder_core"/run/logs/Char.log 2>/dev/null)
        dive_char_login_c=$(grep -c -E "Login" "$folder_core"/run/logs/Char.log 2>/dev/null)
        dive_char_logouts=$(grep -c -E "Logout" "$folder_core"/run/logs/Char.log 2>/dev/null)
        # EventAIErrors.log >
        dive_EventAIError=$(grep -c -E "skipping" "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)
        dive_EventAInoeff=$(grep -c -E "Action\swill\snot\shave\sany\seffect." "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)
        dive_EventAInonex=$(grep -c -E "nonexistent|non-existing" "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)
        dive_EventAI_NULL=$(grep -c -E ".*NULL*." "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)
        dive_EventAINotUs=$(grep -c -E "but\snot\sused" "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)

        # Server.log, .old, Realmd.log >
        dive_log_empty=$(printf "\e[0;33mEmpty....\033[0m")
        dive_log_error=$(printf "\033[0;31mError..\033[0m")
        dive_log_ignor=$(printf "\033[0;31mIgnore.\033[0m")
        dive_log_serio=$(printf "\033[1;31mSerious\033[0m")
        # DBErrors.log >
        dive_log_corre=$(printf "\033[0;31mNotCorresponding\033[0m")
        dive_log_exist=$(printf "\033[0;31mDoesn'tExist....\033[0m")
        dive_log_query=$(printf "\033[0;31mQueryERROR......\033[0m")
        dive_log_never=$(printf "\033[0;31mWillNeverBeUsed.\033[0m")
        dive_log_crash=$(printf "\033[1;31mCanCrashClient!.\033[0m")
        # EventAIErrors.log >
        dive_log_skipp=$(printf "\033[0;31mSkipping\033[0m")
        dive_log_noeff=$(printf "\033[0;31mNoEffect\033[0m")
        dive_log_nonex=$(printf "\033[0;31mNonExist\033[0m")
        dive_log_NULL0=$(printf "\033[0;31mNULL....\033[0m")
        dive_log_NotUs=$(printf "\033[0;31mNotUsed.\033[0m")
        # Char.log >
        dive_log_creat=$(printf "\e[0;33mCreated\033[0m")
        dive_log_login=$(printf "\e[0;33mLogin..\033[0m")
        dive_log_logou=$(printf "\e[0;33mLogout.\033[0m")
        # empty table >
        dive_log_none=$(printf "\e[2mempty..\033[0m")
        dive_log_zero=$(printf "0")
        # codes done

        printf "      Server.log        Server.log.old    Realmd.log"
        echo
        printline "$dive_log_empty" "$dive_server_empty" "$dive_log_empty" "$dive_server_old_empty" "$dive_log_empty" "$dive_realmd_empty"
        printline "$dive_log_error" "$dive_server_error" "$dive_log_error" "$dive_server_old_error" "$dive_log_error" "$dive_realmd_error"
        printline "$dive_log_ignor" "$dive_server_ignor" "$dive_log_ignor" "$dive_server_old_ignor" "$dive_log_ignor" "$dive_realmd_serio"
        printline "$dive_log_serio" "$dive_server_serio" "$dive_log_serio" "$dive_server_old_serio" "$dive_log_serio" "$dive_realmd_serio"
        echo
        printf "      DBErrors.log      Char.log          EventAIErrors.log"
        echo
        printline "$dive_log_corre" "$dive_DBError_corr" "$dive_log_creat" "$dive_char_created" "$dive_log_skipp" "$dive_EventAIError"
        printline "$dive_log_exist" "$dive_DBError_exis" "$dive_log_login" "$dive_char_login_c" "$dive_log_noeff" "$dive_EventAInoeff"
        printline "$dive_log_query" "$dive_DBError_quer" "$dive_log_logou" "$dive_char_logouts" "$dive_log_nonex" "$dive_EventAInonex"
        printline "$dive_log_never" "$dive_DBError_used" "$dive_log_none" "$dive_log_zero" "$dive_log_NULL0" "$dive_EventAI_NULL"
        printline "$dive_log_crash" "$dive_DBError_cras" "$dive_log_none" "$dive_log_zero" "$dive_log_NotUs" "$dive_EventAINotUs"

        # count error from logs
        error_charac=$(grep -c "ERROR:.*" "$folder_core"/run/logs/Char.log 2>/dev/null)
        error_dberro=$(grep -c "ERROR:.*" "$folder_core"/run/logs/DBErrors.log 2>/dev/null)
        error_eventa=$(grep -c "ERROR:.*" "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null)

        echo
        printf '%b' "\e[2m"
        read -r -p "RAW ERROR Output? (y/n) " -n 1 -r
        printf '%b' "\033[0m"
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          # get raw error from logs
          grep -Eo "ERROR:.*|.*empty*." "$folder_core"/run/logs/Server.log 2>/dev/null
          grep -Eo "ERROR:.*|.*empty*." "$folder_core"/run/logs/Realmd.log 2>/dev/null
          grep -Eo "ERROR:.*|.*empty*." "$folder_core"/run/logs/Char.log 2>/dev/null
          grep -Eo "ERROR:.*|.*empty*." "$folder_core"/run/logs/DBErrors.log 2>/dev/null
          grep -Eo "ERROR:.*|.*empty*." "$folder_core"/run/logs/EventAIErrors.log 2>/dev/null
        fi
        # tail logs instead
        printf '%b' "\e[2m"
        read -r -p "tail Output? (y/n) " -n 1 -r
        printf '%b' "\033[0m"
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          # tail logs for error
          tail -f "$folder_core"/run/logs/*.log 2>/dev/null |
            grep -Eo "ERROR:.*|.*empty*." 2>/dev/null
        fi
        printf '%b' "
Server\e[0;32m........:\033[0m $dive_server_error
Realmd\e[0;32m........:\033[0m $dive_realmd_error
Char\e[0;32m..........:\033[0m $error_charac
DBErrors\e[0;32m......:\033[0m $error_dberro
EventAIErrors\e[0;32m.:\033[0m $error_eventa\n"
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # dive into logs done

        # Get database info (kinda heavy..) >

      "w")

        on_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT SUM(online) FROM ${db_characters:?}.characters;" 2>/dev/null)
        gu_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM ${db_characters:?}.guild;" 2>/dev/null)
        ac_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_realmd.account;" 2>/dev/null)
        bn_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_realmd.account_banned;" 2>/dev/null)
        # on_count at TOP ^
        ch_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.characters;" 2>/dev/null)

        # gu_count at TOP ^
        me_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.guild_member;" 2>/dev/null)
        ma_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.mail;" 2>/dev/null)
        pe_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.character_pet;" 2>/dev/null)

        ti_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.gm_tickets;" 2>/dev/null)
        co_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.corpse;" 2>/dev/null)
        pv_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.pvpstats_players;" 2>/dev/null)
        gi_count=$(mysql --defaults-extra-file="${sql_mycnf:?}" -N --execute="SELECT count(*) FROM $db_characters.character_gifts;" 2>/dev/null)

        printline "Accounts" "$ac_count" "Guilds" "$gu_count" "Tickets" "$ti_count"
        printline "Banned" "$bn_count" "Members" "$me_count" "Corpses" "$co_count"
        printline "Online" "$on_count" "Mail" "$ma_count" "PvP" "$pv_count"
        printline "Characters" "$ch_count" "Pets" "$pe_count" "Gifts" "$gi_count"

        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # Get database info (kinda heavy..) done

        # backup sql >

      "b")

        # create directory, backup
        mkdir "$folder_wow"/backup &>/dev/null
        # well (: backup probably hours old by now >
        echo
        printf "Making fresh backup\e[0;32m.\033[0m"
        sleep 1
        printf "\e[0;32m.\033[0m"
        mysqldump --defaults-extra-file="$sql_mycnf" "$db_characters" >"$folder_wow"/backup/"$db_characters"-"$NOW".sql
        printf "\e[0;32m.\033[0m"
        sleep 1
        printf '%b' "[\e[0;32mok\033[0m] $db_characters-$NOW.sql"
        sleep 2
        echo
        # backup characters sql >
        printf "Making fresh backup\e[0;32m.\033[0m"
        sleep 1
        printf "\e[0;32m.\033[0m"
        mysqldump --defaults-extra-file="$sql_mycnf" "$db_realmd" >"$folder_wow"/backup/"$db_realmd"-"$NOW".sql
        printf "\e[0;32m.\033[0m"
        sleep 1
        printf '%b' "[\e[0;32mok\033[0m] $db_realmd-$NOW.sql"
        sleep 1
        # well (: backup probably hours old by now done

        ;;

        # backup sql done

        # remote access >

      "r")

        echo
        read -r -p " Want to login? (y/n) " -n 1 -r
        echo
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          clear
          printf '%b' "
\e[31m      ._________________.
      |.---------------.|
      || \033[0mmangos>\e[31m       ||
      ||               ||
      ||               ||
      ||               ||
      ||               ||
      ||_______________||
      /.-.-.-.-.-.-.-.-.\\
     /.-.-.-.-.-.-.-.-.-.\\
    /.-.-.-.-.-.-.-.-.-.-.\\
   /______/__________\___\e[1;32mo\033[1;31m_\\
   \_______________________/\033[0m"
          echo
          printf "
     CMaNGOS Command Center

  \e[1;32m>\033[0m hit Enter two times to go back.
  ------------------------------------------------
  'commands' will list all of the available commands
  'quit' and then hit Enter two times to exit

  Tip: Set '\e[0;35mMessage of the Day\033[0m' inside mangosd.conf"
          echo
          echo
          nc "$host_nc" "$port_nc"
          echo
        fi

        ;;

        # remote access done

      "q")
        echo
        break
        ;;
      *)
        echo
        echo "empty"
        ;;
      esac
    done

    ;;

    # Login (command) done * Free Hong Kong.

    # Checking for updates >

  "c")

    # updated and installed
    FILE_CORE="/var/log/ms/installed_core"
    if [ -f "$FILE_CORE" ]; then
      ok_core="[\e[0;32mok\033[0m]"
    fi
    FILE_CORE="/var/log/ms/installed_core"
    if [ ! -f "$FILE_CORE" ]; then
      ok_core="[\e[93mok\033[0m]"
    fi
    FILE_DB="/var/log/ms/installed_db"
    if [ -f "$FILE_DB" ]; then
      ok_db="[\e[0;32mok\033[0m]"
    fi
    FILE_DB="/var/log/ms/installed_db"
    if [ ! -f "$FILE_DB" ]; then
      ok_db="[\e[93mok\033[0m]"
    fi
    FILE_MS="/var/log/ms/installed_ms"
    if [ -f "$FILE_MS" ]; then
      ok_ms="[\e[0;32mok\033[0m]"
    fi
    FILE_MS="/var/log/ms/installed_ms"
    if [ ! -f "$FILE_MS" ]; then
      ok_ms="[\e[93mok\033[0m]"
    fi

    # check if 'mangos-classic' exist >
    FILE="$folder_core/README.md"
    if [ ! -f "$FILE" ]; then
      # remove old file
      rm /var/log/ms/installed_core &>/dev/null
      # fresh install ? >
      printf '%b' "Cloning repository 'mangos-classic' Please wait this might take a while
(\e[92m${github_cmangos:?}\033[0m)\n"
      sudo mkdir "$folder_wow" &>/dev/null
      sudo chown -R "${user:?}":"${group:?}" "$folder_wow"
      cd "$folder_wow" || exit
      read -r -p "--recursive? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        recursive="--recursive"
        git clone "${github_cmangos:?}" "$recursive"
      else
        git clone "${github_cmangos:?}"
      fi
      echo "Done"
      sleep 1
    else
      # check for updates >

      # CMaNGOS Core (mangos-classic)
      printf "[ Checking for \e[1;32m+\033[1;31m-\033[0m Updates\033[0m ] .. "
      echo
      echo
      cd "$folder_core" || exit
      if git checkout master &>/dev/null &&
        git fetch origin master &>/dev/null &&
        [ "$(git rev-list HEAD...origin/master --count)" != 0 ] &&
        git merge origin/master; then
        # remove old file
        rm /var/log/ms/installed_core &>/dev/null
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "[\e[92mNEW\033[0m] (\e[4;32m$latest_head\033[0m) \e[4;32mNew Updates For Core\033[0m! - $latest_date
\e[90m(m) Update CMaNGOS > Compile latest\033[0m\n"
      else
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "$ok_core (\e[4;32m$latest_head\033[0m) Core Updated - $latest_date"
        echo
      fi
    # check if 'mangos-classic' exist done
    fi

    # check if 'classic-db' exist >
    FILE="$folder_db/README.md"
    if [ ! -f "$FILE" ]; then
      # remove old file
      rm /var/log/ms/installed_db &>/dev/null
      # fresh install ? >
      printf '%b' "Cloning repository 'classic-db' Please wait this might take a while
(\e[92m${github_database:?})\033[0m\n"
      sudo mkdir "$folder_wow" &>/dev/null
      sudo chown -R "${user:?}":"${group:?}" "$folder_wow"
      cd "$folder_wow" || exit
      git clone "${github_database:?}"
      cd "$folder_db" || exit
      ./InstallFullDB.sh
      echo "Done"
      sleep 1
    else

      # check for updates >

      # check if 'classic-db' exist >

      # Classic Database (classic-db)

      cd "${folder_db:?}" || exit
      if git checkout master &>/dev/null &&
        git fetch origin master &>/dev/null &&
        [ "$(git rev-list HEAD...origin/master --count)" != 0 ] &&
        git merge origin/master; then
        # remove old file
        rm /var/log/ms/installed_db &>/dev/null
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "[\e[92mNEW\033[0m] (\e[4;32m$latest_head\033[0m) \e[4;32mNew Updates For Database\033[0m! - $latest_date
\e[90m(d) Update Database > Update classic-db\033[0m\n"
      else
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "$ok_db (\e[4;32m$latest_head\033[0m) Database Updated - $latest_date"
        echo
      fi
    # check if 'classic-db' exist done
    fi

    # check if 'cmangos-script' exist >
    FILE="$folder_helper/README.md"
    if [ ! -f "$FILE" ]; then
      # remove old file
      rm /var/log/ms/installed_ms &>/dev/null
      # fresh install ? >
      echo "Cloning repository 'cmangos-script' Please wait"
      sudo mkdir "$folder_helper" &>/dev/null
      sudo chown -R "${user:?}":"${group:?}" "$folder_helper"
      cd "$folder_helper" || exit
      git clone "${github_helper:?}"
      echo "Done"
      sleep 1
    else
      # check for updates >

      # CMaNGOS Helper

      cd "${folder_helper:?}" || exit
      if git checkout master &>/dev/null &&
        git fetch origin master &>/dev/null &&
        [ "$(git rev-list HEAD...origin/master --count)" != 0 ] &&
        git merge origin/master; then
        # remove old file
        rm /var/log/ms/installed_ms &>/dev/null
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "[\e[92mNEW\033[0m] (\e[4;32m$latest_head\033[0m) \e[4;32mNew Updates For Helper\033[0m! - $latest_date
\e[90m(w) Update Helper > Update Helper\033[0m\n"
      else
        latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
        latest_head=$(git rev-parse --short HEAD)
        printf '%b' "$ok_ms (\e[4;32m$latest_head\033[0m) Helper Updated - $latest_date"
        echo
      fi
    # check if 'cmangos-script' exist done
    fi
    # check if 'InstallFullDB.config' exist >
    FILE="$folder_db/InstallFullDB.config"
    if [ ! -f "$FILE" ]; then
      cd "$folder_db" || exit
      ./InstallFullDB.sh &>/dev/null
    fi

    # check if 'InstallFullDB.config' exist done
    echo
    read -r -p "Press Enter to continue" </dev/tty
    echo

    ;;

    # Checking for updates done

    # update CMaNGOS >

  "m")

    # codes >
    if ! [ -x "$(command -v dialog)" ]; then
      sudo apt-get install dialog -y 2>/dev/null
    fi
    # required 'packagelist' to build CMaNGOS >
    # ubuntu server
    packagelist=(autoconf
      automake
      binutils
      build-essential
      checkinstall
      cmake
      g++
      gcc
      git
      git-core
      grep
      libboost-all-dev
      libbz2-dev
      libc6
      libmysql++-dev
      libssl-dev
      libtool
      make
      patch
      subversion
      unzip
      zip
      zlibc
      psmisc)
    # codes done
    HEIGHT=12
    WIDTH=41
    CHOICE_HEIGHT=5
    BACKTITLE="update CMaNGOS"
    TITLE="Update mangos-classic [core]"
    MENU="Choose one of the following options:"

    OPTIONS=(1 "Compile latest build"
      2 "Install systemd unit files"
      3 "Reinstall (delete /build)"
      4 "Reset --hard origin/master"
      5 "Delete Core /mangos-classic")

    CHOICE=$(dialog --clear \
      --backtitle "$BACKTITLE" \
      --title "$TITLE" \
      --menu "$MENU" \
      $HEIGHT $WIDTH $CHOICE_HEIGHT \
      "${OPTIONS[@]}" \
      2>&1 >/dev/tty)

    clear
    case $CHOICE in

    # compile latest build >

    "1")

      read -r -p "Compile latest build? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        # this is for docker users
        if [ -f /.dockerenv ]; then
          printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
          sleep 3
          sudo killall screen 2>/dev/null
          # keep old logs >
          cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
          cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
        else

          if ! [ -x "$(command -v "${packagelist[@]}")" ]; then
            sudo apt-get install "${packagelist[@]}" -y 2>/dev/null
          fi
          printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
          echo
          sleep 1

          # service status
          realm_service=realmd
          world_service=mangosd

          # realmd service
          case "$(pidof $realm_service | wc -w)" in
          0) ;;
          *) sudo service realmd stop ;;
          esac

          # mangosd service
          case "$(pidof $world_service | wc -w)" in
          0) ;;
          *) sudo service mangosd stop ;;
          esac
        fi

        sudo chown -R "${user:?}":"${group:?}" "$folder_wow"
        mkdir "$folder_core"/run &>/dev/null
        mkdir "$folder_core"/run/logs &>/dev/null
        mkdir "$folder_core"/run/logs/old &>/dev/null
        touch "$folder_core"/run/logs/Server.log &>/dev/null
        cp "$folder_core"/run/logs/*.log "$folder_core"/run/logs/old
        # ahbot.conf
        cp "$folder_core"/src/game/AuctionHouseBot/ahbot.conf.dist.in "$folder_core"/run/etc/ahbot.conf.dist &>/dev/null
        # new compile, new system logs >
        cd "$folder_core"/run/logs || exit &>/dev/null
        mv -t "$folder_core"/run/logs/old/ Realmd.log Server.log Server.log.old DBErrors.log EventAIErrors.log &>/dev/null
        # done
        sudo chown -R "$user":"$group" "$folder_wow"
        mkdir "$folder_core"/build &>/dev/null
        cd "${folder_build:?}" || exit
        # double quotes ("") and single quotes ('') around > $cmake < will mess things up.
        # shellcheck disable=SC2086
        cmake .. ${cmake:?}
        cd "$folder_build" || exit

        # compiling using multiple cores >

        # cpu temp >
        if awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp &>/dev/null; then
          cpu_temp=$(awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null |
            cut -c -4 2>/dev/null)
          cmake_temp=$(printf '%b' "CPU: \e[1;32m$cpu_temp \033[0m°")
        else
          cmake_temp=$(printf '%b' "")
        fi

        # get cpu model name
        CPU_MODEL=$(lscpu 2>/dev/null | grep 'Model name' 2>/dev/null |
          cut -f 2 -d ":" 2>/dev/null | awk '{$1=$1}1' 2>/dev/null)
        if [ ! -z "$CPU_MODEL" ]; then
          CPU_MODEL=$(printf '%b' "\e[90m$CPU_MODEL\e[33m\n")
        else
          CPU_MODEL=""
        fi

        # count system cores
        CORES=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        if [[ "$CORES" -ge "1" ]]; then
          # report count
          CORES_COUNT=$(printf '%b' "\e[93mThis system has \e[96m$CORES\e[93m cores!
$CPU_MODEL\033[0m")
        else
          CORES_COUNT=""
        fi

        cat <<EOF

$CORES_COUNT $cmake_temp

Compiling using multiple cores:

 1 : 1 core
 2 : 2 cores
 3 : 3 cores
 4 : 4 cores
 8 : 8 cores
 h : 16 cores
 w : 32 cores
 t : 64 cores
 H : 128 cores

 c : custom

 q : quit

EOF
        read -r -n1 -s
        case "$REPLY" in

        "c")

          printf '%b' "\e[90m[  0%] Enter amount of core(s): \033[0m"
          read -r CUSTOM
          cores=("$CUSTOM")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j"$CUSTOM" # custom n cores

          ;;

        "1")

          cores=("1")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make # 1 core

          ;;

        "2")

          cores=("2")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j2 # 2 cores

          ;;

        "3")

          cores=("3")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j3 # 3 cores

          ;;

        "4")

          cores=("4")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j4 # 4 cores

          ;;

        "8")

          cores=("8")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j8 # 8 cores

          ;;

        "h")

          cores=("16")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j16 # 16 cores, h1gh-

          ;;

        "w")

          cores=("32")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j32 # 32 cores, -w@y

          ;;

        "t")

          cores=("64")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j64 # 64 cores, t0

          ;;

        "H")

          cores=("128")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j128 # 128 cores, h3ll

          ;;

        "q") exit ;;
        "Q") echo "case sensitive!!" ;;
        *)
          echo "Invalid option. Restart please.."
          exit
          ;;

        esac

        # compiling using multiple cores done

        # cpu temp >
        if awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp &>/dev/null; then
          cpu_temp=$(awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null |
            cut -c -4 2>/dev/null)
          cmake_temp=$(printf '%b' "CPU: \e[1;32m$cpu_temp\033[0m° with ${cores[0]} core(s).")
        else
          cmake_temp=""
        fi
        echo
        printf '%b' "$cmake_temp

Select install operation"
        echo
        echo " 1) make install"
        echo " 2) checkinstall with backup"
        echo
        read -r n
        case $n in

        "1")

          # create ms folder
          sudo mkdir /var/log/ms/ 2>/dev/null
          # fix ownership
          sudo chown -R "${user:?}":"${group:?}" /var/log/ms
          # create installed mark
          echo "Core was installed at ${NOW:?}" >/var/log/ms/installed_core

          echo "make install"

          cd "$folder_build" || exit
          sudo make install

          ;;

        "2")

          # create ms folder
          sudo mkdir /var/log/ms/ 2>/dev/null
          # fix ownership
          sudo chown -R "${user:?}":"${group:?}" /var/log/ms
          # create installed mark
          echo "Core was installed at ${NOW:?} with backup" >/var/log/ms/installed_core

          echo "checkinstall"

          cd "$folder_build" || exit
          sudo checkinstall

          ;;

        *)
          echo "invalid option"

          ;;

        esac

        sudo chown -R "$user":"$group" "$folder_wow"

        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # compile latest build done

      # install systemd Services >
      # ubuntu

    "2")

      read -r -p "Install systemd Services? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        # /etc/systemd/system/realmd.service
        echo "[Unit]
Description=WoW Vanilla realmd service
After=network.target mysql.service

[Service]
Type=simple
User=$user
ExecStart=$folder_core/run/bin/realmd -c $folder_core/run/etc/realmd.conf
Restart=on-abort

[Install]
WantedBy=multi-user.target" >"$folder_wow"/realmd.service 2>/dev/null
        # /etc/systemd/system/mangosd.service
        echo "[Unit]
Description=WoW Vanilla mangosd service
After=network.target mysql.service realmd.service getty@tty3.service

[Service]
Type=simple
User=$user
StandardInput=tty
TTYPath=/dev/tty3
TTYReset=yes
TTYVHangup=yes
WorkingDirectory=$folder_core/run/bin
ExecStart=$folder_core/run/bin/mangosd -c $folder_core/run/etc/mangosd.conf -a $folder_core/run/etc/ahbot.conf
Restart=on-abort

[Install]
WantedBy=multi-user.target" >"$folder_wow"/mangosd.service 2>/dev/null
        # install services >
        sudo mv "$folder_wow"/*.service /etc/systemd/system/ &>/dev/null
        # enable services >
        sudo systemctl enable realmd
        sleep 1
        sudo systemctl enable mangosd
        # reload >
        sudo systemctl daemon-reload 2>/dev/null
        sleep 1
        echo
        printf '%b' "[\e[0;32mok\033[0m]

/etc/systemd/system/'\e[0;35mrealmd.service\033[0m'
/etc/systemd/system/'\e[0;35mmangosd.service\033[0m'

Check if correct information, or just restart server."
        echo
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # install systemd Services done

      # reinstall (delete /build) >

    "3")

      read -r -p "Reinstall (delete /build)? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        # this is for docker users
        if [ -f /.dockerenv ]; then
          printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
          sleep 3
          sudo killall screen 2>/dev/null
          # keep old logs >
          cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
          cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
        else

          if ! [ -x "$(command -v "${packagelist[@]}")" ]; then
            sudo apt-get install "${packagelist[@]}" -y 2>/dev/null
          fi
          printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
          echo
          sleep 1

          # service status
          realm_service=realmd
          world_service=mangosd

          # realmd service
          case "$(pidof $realm_service | wc -w)" in
          0) ;;
          *) sudo service realmd stop ;;
          esac

          # mangosd service
          case "$(pidof $world_service | wc -w)" in
          0) ;;
          *) sudo service mangosd stop ;;
          esac
        fi

        cd || exit
        sudo mkdir wow &>/dev/null
        sudo chown -R "${user:?}":"${group:?}" "$folder_wow"
        sudo rm -r "$folder_core"/build/ &>/dev/null
        cd "$folder_wow" || exit
        git clone "$github_cmangos" 2>/dev/null
        sudo mkdir "$folder_core"/build &>/dev/null
        sudo chown -R "${user:?}":"${group:?}" "$folder_wow"
        mkdir "$folder_core"/run &>/dev/null
        mkdir "$folder_core"/run/logs &>/dev/null
        mkdir "$folder_core"/run/logs/old &>/dev/null
        touch "$folder_core"/run/logs/Server.log &>/dev/null
        cp "$folder_core"/run/logs/*.log "$folder_core"/run/logs/old
        # ahbot.conf
        cp "$folder_core"/src/game/AuctionHouseBot/ahbot.conf.dist.in "$folder_core"/run/etc/ahbot.conf.dist &>/dev/null
        # new compile, new system logs >
        cd "$folder_core"/run/logs || exit &>/dev/null
        mv -t "$folder_core"/run/logs/old/ Realmd.log Server.log Server.log.old DBErrors.log EventAIErrors.log &>/dev/null
        # done
        sudo chown -R "$user":"$group" "$folder_wow"
        mkdir "$folder_core"/build &>/dev/null
        cd "${folder_build:?}" || exit
        # double quotes ("") and single quotes ('') around > $cmake < will mess things up.
        # shellcheck disable=SC2086
        cmake .. ${cmake:?}
        cd "$folder_build" || exit

        # compiling using multiple cores >

        # cpu temp >
        if awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp &>/dev/null; then
          cpu_temp=$(awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null |
            cut -c -4 2>/dev/null)
          cmake_temp=$(printf '%b' "CPU: \e[1;32m$cpu_temp \033[0m°")
        else
          cmake_temp=$(printf '%b' "")
        fi

        # get cpu model name
        CPU_MODEL=$(lscpu 2>/dev/null | grep 'Model name' 2>/dev/null |
          cut -f 2 -d ":" 2>/dev/null | awk '{$1=$1}1' 2>/dev/null)
        if [ ! -z "$CPU_MODEL" ]; then
          CPU_MODEL=$(printf '%b' "\e[90m$CPU_MODEL\033[0m\n")
        else
          CPU_MODEL=""
        fi

        # count system cores
        CORES=$(grep -c ^processor /proc/cpuinfo 2>/dev/null)
        if [[ "$CORES" -ge "1" ]]; then
          # report count
          CORES_COUNT=$(printf '%b' "\e[93mThis system has \e[96m$CORES\e[93m cores!
$CPU_MODEL\033[0m")
        else
          CORES_COUNT=""
        fi

        cat <<EOF

$CORES_COUNT $cmake_temp

Compiling using multiple cores:

 1 : 1 core
 2 : 2 cores
 3 : 3 cores
 4 : 4 cores
 8 : 8 cores
 h : 16 cores
 w : 32 cores
 t : 64 cores
 H : 128 cores

 c : custom

 q : quit

EOF
        read -r -n1 -s
        case "$REPLY" in

        "c")

          printf '%b' "\e[90m[  0%] Enter amount of core(s): \033[0m"
          read -r CUSTOM
          cores=("$CUSTOM")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j"$CUSTOM" # custom n cores

          ;;

        "1")

          cores=("1")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make # 1 core

          ;;

        "2")

          cores=("2")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j2 # 2 cores

          ;;

        "3")

          cores=("3")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j3 # 3 cores

          ;;

        "4")

          cores=("4")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j4 # 4 cores

          ;;

        "8")

          cores=("8")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j8 # 8 cores

          ;;

        "h")

          cores=("16")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j16 # 16 cores, h1gh-

          ;;

        "w")

          cores=("32")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j32 # 32 cores, -w@y

          ;;

        "t")

          cores=("64")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j64 # 64 cores, t0

          ;;

        "H")

          cores=("128")
          printf '%b' "\e[0;32m[  0%] Building with \033[0m${cores[0]}\e[0;32m core(s)\033[0m\n"
          make -j128 # 128 cores, h3ll

          ;;

        "q") exit ;;
        "Q") echo "case sensitive!!" ;;
        *)
          echo "Invalid option. Restart please.."
          exit
          ;;

        esac

        # compiling using multiple cores done

        # cpu temp >
        if awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp &>/dev/null; then
          cpu_temp=$(awk '{print $cpu/1000}' /sys/class/thermal/thermal_zone0/temp 2>/dev/null |
            cut -c -4 2>/dev/null)
          cmake_temp=$(printf '%b' "CPU: \e[1;32m$cpu_temp\033[0m° with ${cores[0]} core(s).")
        else
          cmake_temp=""
        fi
        echo
        printf '%b' "$cmake_temp

Select install operation"
        echo
        echo " 1) make install"
        echo " 2) checkinstall with backup"
        echo
        read -r n
        case $n in

        "1")
          echo "make install"

          cd "$folder_build" || exit
          sudo make install

          ;;

        "2")
          echo "checkinstall"

          cd "$folder_build" || exit
          sudo checkinstall

          ;;

        *)
          echo "invalid option"

          ;;

        esac

        sudo chown -R "$user":"$group" "$folder_wow"

        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # reinstall (delete /build) done

      # reset --hard origin/master ? >

    "4")

      read -r -p "Reset --hard origin/master? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        cd "$folder_core" || exit
        git reset --hard origin/master
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # reset --hard origin/master done

      # delete core directory (everything)

    "5")

      printf '%b' "\e[90mDeleting Core! $folder_core\033[0m\n"
      read -r -p "Backup configurations first? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        sudo mkdir "${folder_wow:?}"/backup 2>/dev/null
        sudo mkdir "${folder_wow:?}"/backup/configurations 2>/dev/null
        sudo chown -R "$user":"$group" "$folder_wow"
        cp "$folder_core"/run/etc/*.conf "${folder_wow:?}"/backup/configurations 2>/dev/null
      fi
      read -r -p "Delete Core Directory? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        cp "$folder_core"/run/etc/*.conf "${folder_wow:?}"/backup 2>/dev/null
        sudo rm -R "$folder_core" &>/dev/null
      fi

      ;;

      # delete core directory (everything) done

    esac

    # update CMaNGOS done

    # update Database >

    ;;

  "d")

    # codes >
    if ! [ -x "$(command -v dialog)" ]; then
      sudo apt-get install dialog -y 2>/dev/null
    fi
    # codes done
    HEIGHT=19
    WIDTH=40
    CHOICE_HEIGHT=12
    BACKTITLE="update Database"
    TITLE="Update classic-db [database]"
    MENU="Choose one of the following options:"

    OPTIONS=(1 "Update classic-db"
      2 "Drop/Import databases"
      3 "myisam -> innodb (MariaDB)"
      4 "Reinstall (delete /classic-db)"
      5 "Reset --hard origin/master"
      6 "Restart MySQL Server (service)"
      7 "Stop MySQL Server (service)"
      8 "Enable/Disable MySQL Server"
      9 "Apply all updates [A]-[B]"
      10 "Install database client"
      11 "Install database system"
      12 "Delete /classic-db")

    CHOICE=$(dialog --clear \
      --backtitle "$BACKTITLE" \
      --title "$TITLE" \
      --menu "$MENU" \
      $HEIGHT $WIDTH $CHOICE_HEIGHT \
      "${OPTIONS[@]}" \
      2>&1 >/dev/tty)

    clear
    case $CHOICE in

    # delete database directory (everything)

    "12")

      printf '%b' "\e[90mDeleting Database! $folder_db\033[0m\n"
      read -r -p "Delete Database Directory? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        cp "$folder_core"/run/etc/*.conf "${folder_wow:?}"/backup 2>/dev/null
        sudo rm -R "$folder_db" &>/dev/null
      fi

      ;;

      # delete database directory (everything) done

      # install database system >

    "11")

      # codes >
      # check if 'mangos' user exist >
      # mariadb >
      packagelist_maria=(mariadb-client
        mariadb-server)
      # mysql >
      packagelist_mysql=(mysql-client
        mysql-server)
      # codes done
      echo
      printf "MariaDB, MySQL - Database system"
      echo
      echo " 1) MariaDB"
      echo " 2) MySQL"
      echo
      read -r -n1 -s n
      echo "Please wait.."
      case $n in

      "1") # install mariadb >

        sudo apt-get install "${packagelist_maria[@]}" -y
        sudo service mariadb stop &>/dev/null
        sudo service mariadb start &>/dev/null

        ;;

      "2") # install mysql >

        sudo apt-get install "${packagelist_mysql[@]}" -y
        sudo service mysql stop &>/dev/null
        sudo service mysql start &>/dev/null

        ;;

      "*") ;;

      esac

      ;;

      # install database system done

      # install database client >

    "10")

      # codes >
      # mariadb-client >
      packagelist_client_maria=(mariadb-client*)
      # mysql-client >
      packagelist_client_mysql=(mysql-client*)
      # codes done

      echo
      printf "MariaDB, MySQL - Database Client
This is needed to operate local/remote database"
      echo
      echo
      echo " 1 : MariaDB-Client"
      echo " 2 : MySQL-Client"
      echo " q : Quit"
      echo
      read -r -n1 -s n
      echo "Please wait.."
      case $n in

      "1") # install mariadb-client >

        sudo apt-get install "${packagelist_client_maria[@]}" -y

        ;;

      "2") # install mysql-client >

        sudo apt-get install "${packagelist_client_mysql[@]}" -y

        ;;

      "q")
        return

        ;;

      "*")
        exit

        ;;

      esac

      ;;

      # install database client done

      # update classic-db >

    "1")

      # checking depends >

      # mysql >
      if sudo dpkg -s mysql-server &>/dev/null; then
        mysql_server_installed=$(printf '%b' "[\e[1;32mok\033[0m]")
      else
        mysql_server_installed=$(printf '%b' "[\e[1;90mno\033[0m]")
      fi

      # mysql-client >
      if sudo dpkg -s mysql-client &>/dev/null; then
        mysql_client_installed=$(printf '%b' "[\e[1;32mok\033[0m]")
      else
        mysql_client_installed=$(printf '%b' "[\e[1;90mno\033[0m]")
      fi

      # mariadb >
      if sudo dpkg -s mariadb-server &>/dev/null; then
        mariadb_server_installed=$(printf '%b' "[\e[1;32mok\033[0m]")
      else
        mariadb_server_installed=$(printf '%b' "[\e[1;90mno\033[0m]")
      fi

      # mariadb-client >
      if sudo dpkg -s mariadb-client &>/dev/null; then
        mariadb_client_installed=$(printf '%b' "[\e[1;32mok\033[0m]")
      else
        mariadb_client_installed=$(printf '%b' "[\e[1;90mno\033[0m]")
      fi

      mysql_user=$(sudo mysql --defaults-extra-file="$sql_mycnf" -sse "SELECT EXISTS(SELECT 1 FROM mysql.user WHERE user = 'mangos')" 2>/dev/null)
      if [ "$mysql_user" = 1 ]; then
        mysql_user=$(printf '%b' "[\e[1;32mok\033[0m]")
      else
        mysql_user=$(printf '%b' "[\e[1;90mno\033[0m]")
      fi

      echo
      echo "$mysql_server_installed - mysql-server
$mysql_client_installed - mysql-client
$mariadb_server_installed - mariadb-server
$mariadb_client_installed - mariadb-client
$mysql_user - database user 'mangos'

database user, client/server is needed."
      echo

      # checking depends done

      read -r -p "Continue? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        read -r -p "Restart localhost database service? (SQL SERVER) (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # restart mysql service, if it exists >
          if sudo service mysql status 2>/dev/null | grep -E 'mysql'; then
            echo "No database system found
Please install mysql or mariadb database/client"
            echo
            exit
          else
            sudo service mysql stop &>/dev/null
            sudo service mysql restart &>/dev/null
          fi

          # restart mariadb service, if it exists >
          if sudo service mariadb status 2>/dev/null | grep -E 'mariadb'; then
            echo "No database system found
Please install mysql or mariadb database/client"
            echo
            exit
          else
            sudo service mariadb stop &>/dev/null
            sudo service mariadb restart &>/dev/null
          fi
        fi

        printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
        echo
        sleep 1

        # this is for docker users
        if [ -f /.dockerenv ]; then
          printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
          sleep 3
          sudo killall screen 2>/dev/null
          # keep old logs >
          cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
          cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
        else

          # service status
          realm_service=realmd
          world_service=mangosd

          # realmd service
          case "$(pidof $realm_service | wc -w)" in
          0) ;;
          *) sudo service realmd stop ;;
          esac

          # mangosd service
          case "$(pidof $world_service | wc -w)" in
          0) ;;
          *) sudo service mangosd stop ;;
          esac
        fi

        sudo chown -R "$user":"$group" "$folder_wow"
        echo
        printf "Updating classic-db [\e[1;32mdatabase\033[0m]"
        echo

        # backup >
        mkdir "$folder_wow"/backup &>/dev/null
        mkdir "$folder_wow"/backup/old &>/dev/null
        cp "$folder_wow"/backup/*.sql "$folder_wow"/backup/old &>/dev/null
        cd "$folder_wow"/backup/old/ || exit
        zip "$server_name.zip" "$folder_wow"/backup/*.sql &>/dev/null
        find "$folder_wow"/backup/*.sql -mtime +7 -exec rm {} \; &>/dev/null
        find "$folder_wow"/backup/old/*.sql -mtime +14 -exec rm {} \; &>/dev/null
        sleep 1
        # backup <- characters.sql
        echo
        FILE="$folder_wow/backup/$db_characters-$NOW.sql"
        if [ ! -f "$FILE" ]; then
          printf "[\e[0;31mempty\033[0m/\e[0;31mold\033[0m] 'Characters' ! Creating backup.."
          mysqldump --defaults-extra-file="$sql_mycnf" "$db_characters" >"$folder_wow"/backup/"$db_characters"-"$NOW".sql
          echo
        else
          printf '%b' "[\e[0;32mok\033[0m] $db_characters-$NOW.sql exist"
          echo
          read -r -p "New backup? ($db_characters) (y/n) " -n 1 -r
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then
            # backup characters sql >
            echo
            printf "Making fresh backup\e[0;32m.\033[0m"
            sleep 1
            printf "\e[0;32m.\033[0m"
            mysqldump --defaults-extra-file="$sql_mycnf" "$db_characters" >"$folder_wow"/backup/"$db_characters"-"$NOW".sql
            printf "\e[0;32m.\033[0m"
            sleep 1
            printf '%b' "[\e[0;32mok\033[0m] $db_characters-$NOW.sql"
            sleep 2
            echo
          fi
        fi
        echo
        # backup <- realmd.sql
        FILE="$folder_wow/backup/$db_realmd-$NOW.sql"
        if [ ! -f "$FILE" ]; then
          printf "[\e[0;31mempty\033[0m/\e[0;31mold\033[0m] 'Realmd' ! Creating backup.."
          mysqldump --defaults-extra-file="$sql_mycnf" "$db_realmd" >"$folder_wow"/backup/"$db_realmd"-"$NOW".sql
          echo
        else
          printf '%b' "[\e[0;32mok\033[0m] $db_realmd-$NOW.sql exist"
          echo
          read -r -p "New backup? ($db_realmd) (y/n) " -n 1 -r
          echo
          if [[ $REPLY =~ ^[Yy]$ ]]; then
            # backup characters sql >
            echo
            printf "Making fresh backup\e[0;32m.\033[0m"
            sleep 1
            printf "\e[0;32m.\033[0m"
            mysqldump --defaults-extra-file="$sql_mycnf" "$db_realmd" >"$folder_wow"/backup/"$db_realmd"-"$NOW".sql
            printf "\e[0;32m.\033[0m"
            sleep 1
            printf '%b' "[\e[0;32mok\033[0m] $db_realmd-$NOW.sql"
            sleep 1
            echo
          fi
        fi
        # InstallFullDB ? >
        echo
        read -r -p "InstallFullDB? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          sudo chown -R "$user":"$group" "$folder_wow"
          cd "$folder_db" || exit
          ./InstallFullDB.sh
          sudo service mariadb stop &>/dev/null
          sudo service mysql stop &>/dev/null
          sleep 1
          sudo service mariadb restart &>/dev/null
          sudo service mysql restart &>/dev/null
        fi
        # create ms folder
        sudo mkdir /var/log/ms/ 2>/dev/null
        # fix ownership
        sudo chown -R "${user:?}":"${group:?}" /var/log/ms
        # create installed mark
        echo "Database was installed at ${NOW:?}" >/var/log/ms/installed_db
        echo
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # InstallFullDB done

      # backup done

      # update classic-db done

      # drop/import databases >

    "2")

      read -r -p "Drop/Import Databases? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        # this is for docker users
        if [ -f /.dockerenv ]; then
          printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
          sleep 3
          sudo killall screen 2>/dev/null
          # keep old logs >
          cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
          cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
        else

          printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
          echo
          sleep 1

          # service status
          realm_service=realmd
          world_service=mangosd

          # realmd service
          case "$(pidof $realm_service | wc -w)" in
          0) ;;
          *) sudo service realmd stop ;;
          esac

          # mangosd service
          case "$(pidof $world_service | wc -w)" in
          0) ;;
          *) sudo service mangosd stop ;;
          esac
        fi

        sudo chown -R "$user":"$group" "$folder_wow"
        sleep 1
        echo
        # backup <- characters.sql
        FILE="$folder_wow/backup/$db_characters-$NOW.sql"
        if [ ! -f "$FILE" ]; then
          printf "[\e[0;31mempty\033[0m/\e[0;31mold\033[0m] 'Characters' ! Creating backup.."
          mysqldump --defaults-extra-file="$sql_mycnf" "$db_characters" >"$folder_wow"/backup/"$db_characters"-"$NOW".sql
          echo
        else
          printf '%b' "[\e[0;32mok\033[0m] $db_characters-$NOW.sql exist"
          echo
        fi
        # backup <- realmd.sql
        FILE="$folder_wow/backup/$db_realmd-$NOW.sql"
        if [ ! -f "$FILE" ]; then
          printf "[\e[0;31mempty\033[0m/\e[0;31mold\033[0m] 'Realmd' ! Creating backup.."
          mysqldump --defaults-extra-file="$sql_mycnf" "$db_realmd" >"$folder_wow"/backup/"$db_realmd"-"$NOW".sql
          echo
        else
          printf '%b' "[\e[0;32mok\033[0m] $db_realmd-$NOW.sql exist"
          echo
        fi

        # backup done

        # drop databases >

        # drop database 'characters'

        echo
        RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "$db_characters")
        if [ "$RESULT" == "$db_characters" ]; then
          mysqladmin --defaults-extra-file="$sql_mycnf" -f DROP "$db_characters"
        fi
        # drop database 'mangos'
        RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "${db_mangos:?}")
        if [ "$RESULT" == "$db_mangos" ]; then
          mysqladmin --defaults-extra-file="$sql_mycnf" -f DROP "$db_mangos"
        fi
        read -r -p "Drop realmd database? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          # drop database 'realmd'
          RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "$db_realmd")
          if [ "$RESULT" == "$db_realmd" ]; then
            mysqladmin --defaults-extra-file="$sql_mycnf" -f DROP "$db_realmd"
          fi
        fi

        # drop databases done

        # create databases >

        # create database 'characters'
        echo
        RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "$db_characters")
        if [ "$RESULT" == "$db_characters" ]; then
          printf "[\e[0;32mok\033[0m] 'Characters' database installed."
          echo
        else
          printf "[\033[1;31mempty\033[0m] 'Characters' importing.."
          echo
          mysql --defaults-extra-file="$sql_mycnf" -e "CREATE DATABASE $db_characters CHARACTER SET utf8 COLLATE utf8_general_ci"
          mysql --defaults-extra-file="$sql_mycnf" --database="$db_characters" <"${folder_sql:?}"/base/characters.sql
        fi
        # create database 'mangos'
        RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "$db_mangos")
        if [ "$RESULT" == "$db_mangos" ]; then
          printf "[\e[0;32mok\033[0m] 'Mangos' database installed."
          echo
        else
          printf "[\033[1;31mempty\033[0m] 'Mangos' importing.."
          echo
          mysql --defaults-extra-file="$sql_mycnf" -e "CREATE DATABASE $db_mangos CHARACTER SET utf8 COLLATE utf8_general_ci"
          mysql --defaults-extra-file="$sql_mycnf" --database="$db_mangos" <"$folder_sql"/base/mangos.sql
        fi
        # create database 'realmd'
        RESULT=$(mysql --defaults-extra-file="$sql_mycnf" -e "SHOW DATABASES" | grep "$db_realmd")
        if [ "$RESULT" == "$db_realmd" ]; then
          printf "[\e[0;32mok\033[0m] 'Realmd' database installed."
          echo
        else
          printf "[\033[1;31mempty\033[0m] 'Realmd' importing.."
          echo
          mysql --defaults-extra-file="$sql_mycnf" -e "CREATE DATABASE $db_realmd CHARACTER SET utf8 COLLATE utf8_general_ci"
          mysql --defaults-extra-file="$sql_mycnf" --database="$db_realmd" <"$folder_sql"/base/realmd.sql
        fi
        echo

        # create databases done

        # delete and start over done

        # InstallFullDB ? >

        read -r -p "InstallFullDB? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          sudo chown -R "$user":"$group" "$folder_wow"
          cd "$folder_db" || exit
          ./InstallFullDB.sh
        fi

        # InstallFullDB done

        # import backup ? >

        echo
        ls -lQS "$folder_wow"/backup
        echo
        read -r -p "Import latest backup? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          sleep 1
          echo -ne '(0%)\r'
          mysql --defaults-extra-file="$sql_mycnf" "$db_characters" <"$folder_wow"/backup/"$db_characters"-"$NOW".sql
          sleep 1
          echo -ne '(25%)\r'
          mysql --defaults-extra-file="$sql_mycnf" "$db_realmd" <"$folder_wow"/backup/"$db_realmd"-"$NOW".sql
          sleep 1
          echo -ne '(50%)\r'
          sudo service mariadb stop &>/dev/null
          sudo service mysql stop &>/dev/null
          echo -ne '(75%)\r'
          sleep 1
          echo -ne '(90%)\r'
          sudo service mariadb restart &>/dev/null
          sudo service mysql restart &>/dev/null
          echo -ne '(100%)\r'
        fi
        echo
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # drop/import databases done

      # update Database done

      # import backup done

      # convert_mysql_engine = myisam -> innodb >

    "3")

      read -r -p "Convert MySQL Engine = myisam -> innodb? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        # this is for docker users
        if [ -f /.dockerenv ]; then
          printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
          sleep 3
          sudo killall screen 2>/dev/null
          # keep old logs >
          cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
          cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
        else

          printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
          echo
          sleep 1

          # service status
          realm_service=realmd
          world_service=mangosd

          # realmd service
          case "$(pidof $realm_service | wc -w)" in
          0) ;;
          *) sudo service realmd stop ;;
          esac

          # mangosd service
          case "$(pidof $world_service | wc -w)" in
          0) ;;
          *) sudo service mangosd stop ;;
          esac
        fi

        sudo chown -R "$user":"$group" "$folder_wow"
        echo -ne '(0%)\r'
        sleep 1
        echo -ne '(10%)\r'
        TABLES=$(sudo mysql --defaults-extra-file="$sql_mycnf" --skip-column-names -B -D "$db_mangos" -e 'show tables')
        for T in $TABLES; do
          echo -ne '(20%)\r'
          sudo mysql --defaults-extra-file="$sql_mycnf" -D "$db_mangos" -e "ALTER TABLE $T Engine=InnoDB ROW_FORMAT=DYNAMIC"
          echo -ne '(30%)\r'
        done
        echo -ne '(40%)\r'
        sleep 1
        echo -ne '(50%)\r'
        TABLES=$(sudo mysql --defaults-extra-file="$sql_mycnf" --skip-column-names -B -D "$db_realmd" -e 'show tables')
        for T in $TABLES; do
          echo -ne '(60%)\r'
          sudo mysql --defaults-extra-file="$sql_mycnf" -D "$db_realmd" -e "ALTER TABLE $T Engine=InnoDB ROW_FORMAT=DYNAMIC"
        done
        echo -ne '(70%)\r'
        sleep 1
        echo -ne '(80%)\r'
        TABLES=$(sudo mysql --defaults-extra-file="$sql_mycnf" --skip-column-names -B -D "$db_characters" -e 'show tables')
        for T in $TABLES; do
          echo -ne '(90%)\r'
          sudo mysql --defaults-extra-file="$sql_mycnf" -D "$db_characters" -e "ALTER TABLE $T Engine=InnoDB ROW_FORMAT=DYNAMIC"
          echo -ne '(95%)\r'
        done
        echo -ne '(96%)\r'
        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        echo -ne '(97%)\r'
        sleep 1
        echo -ne '(98%)\r'
        sudo service mariadb restart &>/dev/null
        sudo service mysql restart &>/dev/null
        echo -ne '(99%)\r'
        sleep 1
        echo -ne '(100%)\r'
        echo
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # convert_mysql_engine = myisam -> innodb done

      # reinstall (delete /classic-db) >

    "4")

      read -r -p "Reinstall (Delete /classic-db)? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        sudo chown -R "$user":"$group" "$folder_wow"
        cp "$folder_db"/InstallFullDB.config "$folder_wow" &>/dev/null
        sudo rm -r "$folder_db" &>/dev/null
        cd "$folder_wow" || exit
        git clone "$github_database"
        mv "$folder_wow"/*.config "$folder_db" &>/dev/null
        sudo chown -R "$user":"$group" "$folder_wow"
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # reinstall (delete /classic-db) done

      # reset --hard origin/master >

    "5")

      read -r -p "Reset --hard origin/master? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        cd "$folder_db" || exit
        git reset --hard origin/master
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # reset --hard origin/master done

      # restart mysql/mariadb server (service) >

    "6")

      clear
      cat <<EOF
 Database system
 (service)

 1 : Restart MariaDB
 2 : Restart MySQL
 q : Quit

EOF
      read -r -n1 -s
      case "$REPLY" in

      # restart mariadb >

      "1")

        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mariadb restart &>/dev/null
        sleep 1
        sudo service mariadb status 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # restart mysql >

      "2")

        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mysql restart &>/dev/null
        sleep 1
        sudo service mysql status 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

      "q") return ;;
      "Q") echo "case sensitive!!" ;;
      *) echo "invalid option" ;;

      esac

      ;;

      # restart mysql/mariadb server (service) done

      # Stop mysql/mariadb server (service) >

    "7")

      clear
      cat <<EOF
 Database system
 (service)

 1 : Stop MySQL
 2 : Stop MariaDB
 q : Quit

EOF
      read -r -n1 -s
      case "$REPLY" in

      # stop mysql >

      "1")

        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mysql status 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # stop mariadb >

      "2")

        sudo service mariadb stop &>/dev/null
        sleep 1
        sudo service mariadb status 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

      "q") return ;;
      "Q") echo "case sensitive!!" ;;
      *) echo "invalid option" ;;

      esac

      ;;

      # Stop mysql/mariadb server (service) done

      # enable/disable mysql/mariadb server >

    "8")

      clear
      cat <<EOF
 Enable/Disable MySQL
 (systemctl)

 1 : Enable MySQL
 2 : Disable MySQL
 3 : Enable MariaDB
 4 : Disable MariaDB
 q : Quit

EOF
      read -r -n1 -s
      case "$REPLY" in

      # enable mysql >

      "1")

        sudo systemctl enable mysql 2>/dev/null
        sudo systemctl enable mysql.service 2>/dev/null
        # reload >
        sudo systemctl daemon-reload 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # disable mysql >

      "2")

        sudo systemctl disable mysql 2>/dev/null
        sudo systemctl disable mysql.service 2>/dev/null
        # reload >
        sudo systemctl daemon-reload 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # enable mariadb >

      "3")

        sudo systemctl enable mariadb@.service 2>/dev/null
        sudo systemctl enable mariadb@ 2>/dev/null
        # reload >
        sudo systemctl daemon-reload 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

        # disable mariadb >

      "4")

        sudo systemctl disable mariadb@ 2>/dev/null
        sudo systemctl disable mariadb.service 2>/dev/null
        # reload >
        sudo systemctl daemon-reload 2>/dev/null
        echo
        read -r -p "Press Enter to continue" </dev/tty
        echo

        ;;

      "q") return ;;
      "Q") echo "case sensitive!!" ;;
      *) echo "invalid option" ;;

      esac

      ;;

      # enable/disable mysql/mariadb server >

      # apply all updates [A] to [B] >

    "9")

      sudo chown -R "$user":"$group" "$folder_wow"
      printf '%b' "[\033[1;31mWarning\033[0m]: Only update whats missing.
Check log for which database needs 'applying updates'"
      echo
      # combine [A] to [B] updates individually >
      cat "${folder_core:?}"/sql/updates/characters/*.sql >"$folder_wow"/.all_characters.sql
      cat "${folder_core:?}"/sql/updates/mangos/*.sql >"$folder_wow"/.all_mangos.sql
      cat "${folder_core:?}"/sql/updates/realmd/*.sql >"$folder_wow"/.all_realmd.sql

      # apply all updates [A] to [B] characters ? >
      echo
      read -r -p "Characters? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        printf '%b' "Loading.."
        echo
        sleep 1

        # service status
        realm_service=realmd
        world_service=mangosd

        # realmd service
        case "$(pidof $realm_service | wc -w)" in
        0) ;;
        *) sudo service realmd stop ;;
        esac

        # mangosd service
        case "$(pidof $world_service | wc -w)" in
        0) ;;
        *) sudo service mangosd stop ;;
        esac

        echo
        read -r -p "Without error output? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_characters" <"$folder_wow"/.all_characters.sql 2>/dev/null
        else
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_characters" <"$folder_wow"/.all_characters.sql
        fi
        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mariadb restart &>/dev/null
        sudo service mysql restart &>/dev/null
        printf '%b' "[\e[0;32mok\033[0m]"
        echo
      fi
      # apply all updates [A] to [B] mangos ? >
      read -r -p "Mangos? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        printf '%b' "Loading.."
        echo
        sleep 1

        # service status
        realm_service=realmd
        world_service=mangosd

        # realmd service
        case "$(pidof $realm_service | wc -w)" in
        0) ;;
        *) sudo service realmd stop ;;
        esac

        # mangosd service
        case "$(pidof $world_service | wc -w)" in
        0) ;;
        *) sudo service mangosd stop ;;
        esac

        echo
        read -r -p "Without error output? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_mangos" <"$folder_wow"/.all_mangos.sql 2>/dev/null
        else
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_mangos" <"$folder_wow"/.all_mangos.sql
        fi
        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mariadb restart &>/dev/null
        sudo service mysql restart &>/dev/null
        printf '%b' "[\e[0;32mok\033[0m]"
        echo
      fi
      # apply all updates [A] to [B] realmd ? >
      read -r -p "Realmd? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        printf '%b' "Loading.."
        echo
        sleep 1

        # service status
        realm_service=realmd
        world_service=mangosd

        # realmd service
        case "$(pidof $realm_service | wc -w)" in
        0) ;;
        *) sudo service realmd stop ;;
        esac

        # mangosd service
        case "$(pidof $world_service | wc -w)" in
        0) ;;
        *) sudo service mangosd stop ;;
        esac

        echo
        read -r -p "Without error output? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_realmd" <"$folder_wow"/.all_realmd.sql 2>/dev/null
        else
          mysql --defaults-extra-file="$sql_mycnf" -f --database="$db_realmd" <"$folder_wow"/.all_realmd.sql
        fi
        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mariadb restart &>/dev/null
        sudo service mysql restart &>/dev/null
        printf '%b' "[\e[0;32mok\033[0m]"
        echo
      fi
      # remove old 'combined updates' sql files >
      rm "$folder_wow"/.*.sql 2>/dev/null
      # InstallFullDB ? >
      echo
      printf '%b' "\e[0;32mRecommended if you applied anything\033[0m"
      echo
      read -r -p "InstallFullDB? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        printf '%b' "Loading.."
        echo
        sleep 1

        # service status
        realm_service=realmd
        world_service=mangosd

        # realmd service
        case "$(pidof $realm_service | wc -w)" in
        0) ;;
        *) sudo service realmd stop ;;
        esac

        # mangosd service
        case "$(pidof $world_service | wc -w)" in
        0) ;;
        *) sudo service mangosd stop ;;
        esac

        printf '%b' "[\e[0;32mok\033[0m]"
        echo
        sudo chown -R "$user":"$group" "$folder_wow"
        cd "$folder_db" || exit
        ./InstallFullDB.sh
        sudo service mariadb stop &>/dev/null
        sudo service mysql stop &>/dev/null
        sleep 1
        sudo service mariadb restart &>/dev/null
        sudo service mysql restart &>/dev/null
        printf '%b' "[\e[0;32mok\033[0m] "
      fi
      read -r -p "Press Enter to continue" </dev/tty
      echo

      ;;

      # apply all updates [A] to [B] done

    esac

    ;;

    # update database done

    # accounts >

  "u")

    echo "User Accounts"
    echo
    mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT username, gmlevel, lockedIp, active_realm_id, id FROM $db_realmd.account;" 2>/dev/null
    read -r -p "Last Logins? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT id, accountId, ip, loginTime, loginSource, id FROM $db_realmd.account_logons;" 2>/dev/null
    fi
    read -r -p "Check database size? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      mysql --defaults-extra-file="$sql_mycnf" <<<"SELECT table_name AS 'Tables', round(((data_length + index_length) / 1024 / 1024), 2) 'Size in MB' FROM information_schema.TABLES WHERE table_schema = \"$db_realmd\" ORDER BY (data_length + index_length) DESC;" | head
      read -r -p "Press Enter to continue" </dev/tty
    fi

    ;;

    # accounts done

    # characters >

  "t")

    # get class count
    FILE_CLASSES="/var/log/ms/classes.$NOW"
    if [ ! -f $FILE_CLASSES ]; then
      # remove old file
      rm /var/log/ms/classes.* &>/dev/null
      # get classes from table characters
      mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT class FROM $db_characters.characters;" 2>/dev/null |
        tr -d 'class' >/var/log/ms/classes."$NOW" # update this everyday
    fi

    # index class, count each one
    WARRIOR=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | egrep -x '.{1}' 2>/dev/null | grep "1" 2>/dev/null | wc -l 2>/dev/null)
    PALADIN=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "2" 2>/dev/null | wc -l 2>/dev/null)
    HUNTER=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "3" 2>/dev/null | wc -l 2>/dev/null)
    ROGUE=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "4" 2>/dev/null | wc -l 2>/dev/null)
    PRIEST=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "5" 2>/dev/null | wc -l 2>/dev/null)
    SHAMAN=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "7" 2>/dev/null | wc -l 2>/dev/null)
    MAGE=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "8" 2>/dev/null | wc -l 2>/dev/null)
    WARLOCK=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "9" 2>/dev/null | wc -l 2>/dev/null)
    DRUID=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | egrep -x '.{2}' 2>/dev/null | grep "11" 2>/dev/null | wc -l 2>/dev/null)

    # total count
    CLASS_TOTAL=$(cat /var/log/ms/classes."$NOW" 2>/dev/null | grep "[1-9]" 2>/dev/null | wc -l 2>/dev/null)

    # percentage of each class
    WARRIOR_P=$(echo "100/$CLASS_TOTAL*$WARRIOR" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    PALADIN_P=$(echo "100/$CLASS_TOTAL*$PALADIN" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    HUNTER_P=$(echo "100/$CLASS_TOTAL*$HUNTER" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    ROGUE_P=$(echo "100/$CLASS_TOTAL*$ROGUE" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    PRIEST_P=$(echo "100/$CLASS_TOTAL*$PRIEST" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    SHAMAN_P=$(echo "100/$CLASS_TOTAL*$SHAMAN" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    MAGE_P=$(echo "100/$CLASS_TOTAL*$MAGE" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    WARLOCK_P=$(echo "100/$CLASS_TOTAL*$WARLOCK" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)
    DRUID_P=$(echo "100/$CLASS_TOTAL*$DRUID" 2>/dev/null | bc -l 2>/dev/null | awk -F. '{ print $1 }' 2>/dev/null)

    echo "Characters"
    echo
    mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT name, level, online, account, class FROM $db_characters.characters;" 2>/dev/null
    printf '%b' "
Classes

\e[90m1 \033[0m Warrior\e[32m.:\033[0m $WARRIOR \e[90m$WARRIOR_P%\033[0m
\e[90m2 \033[0m Paladin\e[32m.:\033[0m $PALADIN \e[90m$PALADIN_P%\033[0m
\e[90m3 \033[0m Hunter\e[32m..:\033[0m $HUNTER \e[90m$HUNTER_P%\033[0m
\e[90m4 \033[0m Rogue\e[32m...:\033[0m $ROGUE \e[90m$ROGUE_P%\033[0m
\e[90m5 \033[0m Priest\e[32m..:\033[0m $PRIEST \e[90m$PRIEST_P%\033[0m
\e[90m7 \033[0m Shaman\e[32m..:\033[0m $SHAMAN \e[90m$SHAMAN_P%\033[0m
\e[90m8 \033[0m Mage\e[32m....:\033[0m $MAGE \e[90m$MAGE_P%\033[0m
\e[90m9 \033[0m Warlock\e[32m.:\033[0m $WARLOCK \e[90m$WARLOCK_P%\033[0m
\e[90m11\033[0m Druid\e[32m...:\033[0m $DRUID \e[90m$DRUID_P%\033[0m\n"
    echo
    read -r -p "Check database size? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      mysql --defaults-extra-file="$sql_mycnf" <<<"SELECT table_name AS 'Tables', round(((data_length + index_length) / 1024 / 1024), 2) 'Size in MB' FROM information_schema.TABLES WHERE table_schema = \"$db_characters\" ORDER BY (data_length + index_length) DESC;" | head
      read -r -p "Press Enter to continue" </dev/tty
    fi

    ;;

    # characters done

    # guilds >

  "g")

    echo "Guilds"
    echo
    mysql --defaults-extra-file="$sql_mycnf" --execute="SELECT name, motd FROM $db_characters.guild;" 2>/dev/null
    read -r -p "Press Enter to continue" </dev/tty

    ;;

    # guilds done

    # shutdown server ? >> (ﾉ °益°)ﾉ 彡 ┻━┻ holy *@?!1kek .. need muh grindz x()<zz ! OO

  "s")

    # check if 'mangosd.conf' are installed >
    FILE="$folder_core/run/etc/mangosd.conf"
    if [ ! -f "$FILE" ]; then
      echo "Please edit mangosd.conf.dist into mangosd.conf"
      printf '%b' "\e[90mmangosd.conf\033[0m not found."
      echo
      echo
      read -r -p "hit Enter to go back." </dev/tty
      echo
    fi
    # check if 'realmd.conf' are installed >
    FILE="$folder_core/run/etc/realmd.conf"
    if [ ! -f "$FILE" ]; then
      echo "Please edit realmd.conf.dist into realmd.conf"
      printf '%b' "\e[90mrealmd.conf\033[0m not found."
      echo
      echo
      read -r -p "hit Enter to go back." </dev/tty
      echo
    else
      HEIGHT=10
      WIDTH=30
      CHOICE_HEIGHT=4
      BACKTITLE="shutdown server"
      TITLE="Service Control"
      MENU="Choose one option:"

      OPTIONS=(1 "Shutdown Server"
        2 "Shutdown realmd"
        3 "Shutdown mangosd")

      CHOICE=$(dialog --clear \
        --backtitle "$BACKTITLE" \
        --title "$TITLE" \
        --menu "$MENU" \
        $HEIGHT $WIDTH $CHOICE_HEIGHT \
        "${OPTIONS[@]}" \
        2>&1 >/dev/tty)

      clear
      case $CHOICE in

      # shutdown realmd, mangosd >

      "1")

        read -r -p "Shutdown realmd, mangosd? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "realmd" 2>/dev/null; then
              echo "Killing screen (realmd)"
            fi
            if screen -list 2>/dev/null |
              grep -q "mangosd" 2>/dev/null; then
              echo "Killing screen (mangosd)"
            fi
            printf '%b' "\e[90mKilling screens (realmd, mangosd)\033[0m\n"
            sleep 3
            sudo killall screen 2>/dev/null
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
            # done
            printf "\e[91mShutting down\e[90m realmd & mangosd service\033[0m"
            echo
            sleep 1
            echo -ne '(0%)\r'
            sleep 1

            # this is for docker users
            if [ -f /.dockerenv ]; then
              # keep old logs >
              cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
              cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
            else

              # service status
              realm_service=realmd
              world_service=mangosd

              # realmd service
              case "$(pidof $realm_service | wc -w)" in
              0) ;;
              *) sudo service realmd stop ;;
              esac

              echo -ne '(50%)\r'
              sleep 1

              # mangosd service
              case "$(pidof $world_service | wc -w)" in
              0) ;;
              *) sudo service mangosd stop ;;
              esac
            fi

            echo -ne '(100%)\r'
            sleep 1
          fi
        fi

        ;;

        # shutdown realmd, mangosd done

        # shutdown realmd >

      "2")

        read -r -p "Shutdown realmd? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "realmd" 2>/dev/null; then
              echo "Killing screen (realmd)"
            fi
            sleep 3
            # get realmd screen id
            REALMD_ID=$(screen -list 2>/dev/null | grep -Eo "[0-9]+.realmd" 2>/dev/null |
              awk -F. '{ print $1 }' 2>/dev/null)
            # kill that screen
            screen -S "$REALMD_ID" -X quit
            screen -S realmd -X quit
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
            # done
            printf "\e[0;31mShutting down\033[0m realmd service"

            # service status
            realm_service=realmd

            # realmd service
            case "$(pidof $realm_service | wc -w)" in
            0) ;;
            *) sudo service realmd stop ;;
            esac
          fi
        fi

        ;;

        # shutdown realmd done

        # shutdown mangosd >

      "3")

        read -r -p "Shutdown mangosd? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "mangosd" 2>/dev/null; then
              echo "Killing screen (mangosd)"
            fi
            sleep 3
            # get mangosd screen id
            MANGOSD_ID=$(screen -list 2>/dev/null | grep -Eo "[0-9]+.mangosd" 2>/dev/null |
              awk -F. '{ print $1 }' 2>/dev/null)
            # kill that screen
            screen -S "$MANGOSD_ID" -X quit
            screen -S mangosd -X quit
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            # done
            printf "\e[0;31mShutting down\033[0m mangosd service"

            # service status
            world_service=mangosd

            # mangosd service
            case "$(pidof $world_service | wc -w)" in
            0) ;;
            *) sudo service mangosd stop ;;
            esac
          fi
        fi

        ;;

        # shutdown mangosd done

      esac
    fi

    ;;

    # shutdown server done << it's over!!

    # restart server >

  "r")

    # check if 'mangosd.conf' are installed >
    FILE="$folder_core/run/etc/mangosd.conf"
    if [ ! -f "$FILE" ]; then
      echo "Please edit mangosd.conf.dist into mangosd.conf"
      printf '%b' "\e[90mmangosd.conf\033[0m not found."
      echo
      echo
      read -r -p "hit Enter to go back." </dev/tty
      echo
    fi
    # check if 'realmd.conf' are installed >
    FILE="$folder_core/run/etc/realmd.conf"
    if [ ! -f "$FILE" ]; then
      echo "Please edit realmd.conf.dist into realmd.conf"
      printf '%b' "\e[90mrealmd.conf\033[0m not found."
      echo
      echo
      read -r -p "hit Enter to go back." </dev/tty
      echo
    else
      if ! [ -x "$(command -v screen)" ]; then
        sudo apt-get install screen -y 2>/dev/null
      fi
      # codes >
      # realmd.log
      realmd_log_empty="\e[0;33mEmpty\033[0m -> "
      realmd_log_error="\033[0;31mError\033[0m -> "
      realmd_log_failed="\033[0;31mRealm halted or failed\033[0m"
      realmd_log_ok="\e[0;32mok\033[0m"

      # server.log
      server_log_initialized="\e[0;32mWorld initialized\033[0m"
      server_log_serious="\033[1;31mSerious\033[0m -> "
      server_log_failed="\033[0;31mWorld halted or failed\033[0m"
      server_log_error="\033[0;31mError\033[0m -> "
      server_log_empty="\e[0;33mEmpty\033[0m -> "
      server_log_ok="\e[0;32mok\033[0m"

      # service status
      world_service=mangosd
      realm_service=realmd
      # codes done

      HEIGHT=10
      WIDTH=30
      CHOICE_HEIGHT=4
      BACKTITLE="restart server"
      TITLE="Service Control"
      MENU="Choose one option:"

      OPTIONS=(1 "Restart server"
        2 "Restart realmd"
        3 "Restart mangosd")

      CHOICE=$(dialog --clear \
        --backtitle "$BACKTITLE" \
        --title "$TITLE" \
        --menu "$MENU" \
        $HEIGHT $WIDTH $CHOICE_HEIGHT \
        "${OPTIONS[@]}" \
        2>&1 >/dev/tty)

      clear
      case $CHOICE in

      # restart realmd,mangos >

      "1")

        read -r -p "Restart realmd,mangos? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "realmd" 2>/dev/null; then
              echo "Killing screen (realmd)"
            fi
            if screen -list 2>/dev/null |
              grep -q "mangosd" 2>/dev/null; then
              echo "Killing screen (mangosd)"
            fi
            sleep 3
            sudo killall screen 2>/dev/null
            echo "Starting server with screen
'screen -list' -> 'screen -r NUM'"
            sleep 3
            # remove dead screens
            screen -wipe 2>/dev/null
            # setup screens
            screen -dmS realmd
            screen -dmS mangosd
            # setup variables ruled by configuration
            REALMD_SCREEN="$folder_core/run/bin/./realmd -c $folder_core/run/etc/realmd.conf\n"
            MANGOSD_SCREEN="$folder_core/run/bin/./mangosd -c $folder_core/run/etc/mangosd.conf\n"
            # implement daemons inside newly made screens
            screen -S realmd -X -p 0 stuff "$REALMD_SCREEN"
            screen -S mangosd -X -p 0 stuff "$MANGOSD_SCREEN"
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
            # done
            printf "\e[1;32mRestarting\033[0m server"
            echo
            echo -ne '(0%)\r'
            sleep 1
            sudo service realmd restart &>/dev/null
            echo -ne '(50%)\r'
            sleep 1
            sudo service mangosd restart &>/dev/null
            echo -ne '(100%)\r'
            sleep 1
            echo
            echo "Please wait"

            # wait wordlist >
            # note - don't put any space(s) between keywords.

            # realmd >
            wordlist_realmd=(".*[A]\sYou\shave:\s-->*.
.*[B]\sYou\sneed:\s-->*.
.*Added\srealm\sid*.
.*Can't\sconnect\sto\slocal\sMySQL*.
.*cannot\sfind\sthe\sversion\sinfo*.
.*database\sis\smissing\sor\scorrupt*.
.*reinstall\syour*.")
            # mangosd >

            wordlist_mangosd=(".*[A]\sYou\shave:\s-->*.
.*[B]\sYou\sneed:\s-->*.
.*Can't\sconnect\sto\slocal\sMySQL*.
.*core\sdumped*.
.*corrupt*.
.*critical*.
.*fail*.
.*failed*.
.*fatal*.
.*file\struncated*.
.*Halting\sprocess*.
.*initialized*.
.*malformed*.
.*out\sof\sdate!*.
.*reinstall\syour*.
.*segfault*.
.*Segmentation\sfault*.
.*STARTUP*.
.*TIME*.
.*You\smust\sapply\sall\supdates\safter\s[A]\sto\s[B]*.")

            # wait wordlist done

            # wait for realmd & mangosd to fill up logs >

            # Realmd.log >
            tail -f "$folder_core"/run/logs/Realmd.log 2>/dev/null |
              { grep -q -m 1 "${wordlist_realmd[@]}" && pkill -P $$ -x tail 2>/dev/null; }
            # Server.log >
            tail -f "$folder_core"/run/logs/Server.log 2>/dev/null |
              { grep -q -m 1 "${wordlist_mangosd[@]}" && pkill -P $$ -x tail 2>/dev/null; }
            # wait for realmd & mangosd to fill up logs done

            clear

            # realmd service
            case "$(pidof $realm_service | wc -w)" in
            0) printf "Realm [\033[1;31minactive\033[0m] " ;;
            1) printf "Realm [\e[0;32mactive\033[0m] " ;;
            *) printf "Realm [\e[0;33mok?\033[0m] " ;;
            esac

            # mangosd service
            case "$(pidof $world_service | wc -w)" in
            0) printf "World [\033[1;31minactive\033[0m] " ;;
            1) printf "World [\e[0;32mactive\033[0m] " ;;
            *) printf "World [\e[0;33mok?\033[0m] " ;;
            esac

            echo
            # realmd.log
            printf "\e[1;90m<------------------------------------------------------>\033[0m"
            echo
            # if realm failed
            if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault|file\struncated|Halting\sprocess" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
              # if any, print "Realm failed or halted"
              echo
              printf '%b' "$realmd_log_failed"
              echo
            else
              # look for empty tables
              if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                # if any, print "empty"
                printf "Server.log "
                printf '%b' "$realmd_log_empty"
                # count empty inside log
                grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log 2>/dev/null
              fi
              # look for error
              if grep -E -q ".*ERROR*." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                # if any, print "error"
                printf "Realmd.log "
                printf '%b' "$realmd_log_error"
                # count errors inside log
                grep -c -E ".*ERROR*." "$folder_core"/run/logs/Realmd.log 2>/dev/null
              # if nothing, print "ok"
              else
                printf "Realmd.log "
                printf '%b' "$realmd_log_ok"
                echo
              fi
              # this database (realmd) is out of date!
              if grep -E -q "You\shave:\s-->" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                echo
                printf '%b' "Database is out of date!
\e[90m(d) Update Database > Apply all updates [A]-[B]\033[0m"
                echo
              fi
              # databases is missing or corrupt.
              if grep -E -q "\sdatabase\sis\smissing\sor\scorrupt." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                echo
                printf '%b' "Database is missing or corrupt!"
                echo
              fi
              # reinstall your (realmd) database
              if grep -E -q "reinstall\syour|\sUnknown\sdatabase\s|Reinstall\syour\s[REALMD]\sdatabase\s" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                echo
                printf '%b' "Reinstall your database!"
                echo
              fi
              # your realmd.conf version indicates your conf file is out of date
              if grep -E -q ".*Your\srealmd.conf\sversion\sindicates\syour\sconf\sfile\sis\sout\sof\sdate*." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
                echo
                printf "\033[1;31mWARNING\033[0m "
                printf '%b' "realmd.conf is out of date!"
                echo
              fi
            fi
            echo
            tail "$folder_core"/run/logs/Realmd.log 2>/dev/null
            # server.log
            printf "\e[1;90m<------------------------------------------------------>\033[0m"
            echo
            # if world failed
            if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault|file\struncated|Halting\sprocess" "$folder_core"/run/logs/Server.log 2>/dev/null; then
              # if any, print "World failed or halted"
              echo
              printf '%b' "$server_log_failed"
              echo
            else
              # look for empty tables
              if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "empty"
                printf "Server.log "
                printf '%b' "$server_log_empty"
                # count empty inside log
                grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Server.log 2>/dev/null
              fi
              # look for error
              if grep -E -q ".*ERROR*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "error"
                printf "Server.log "
                printf '%b' "$server_log_error"
                # count errors inside log
                grep -c -E ".*ERROR*." "$folder_core"/run/logs/Server.log 2>/dev/null
                # look for serious error
                if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                  # if any, print "serious"
                  printf "Server.log "
                  printf '%b' "$server_log_serious"
                  # count serious errors inside log
                  grep -c -E "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log 2>/dev/null
                fi
              # if nothing, print "ok"
              else
                printf "Server.log "
                printf '%b' "$server_log_ok"
                echo
              fi
              # world failed
              if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault|file\struncated|Halting\sprocess" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "World failed"
                echo
                printf '%b' "$server_log_failed"
                echo
              fi
              # this database (mangosd) is out of date!
              if grep -E -q "You\shave:\s-->" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                echo
                printf '%b' "Database is out of date!
\e[90m(d) Update Database > Apply all updates [A]-[B]\033[0m"
                echo
              fi
              # databases is missing or corrupt.
              if grep -E -q "\sdatabase\sis\smissing\sor\scorrupt." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                echo
                printf '%b' "Database is missing or corrupt!"
                echo
              fi
              # reinstall your (mangosd) database
              if grep -E -q "reinstall\syour|Reinstall\syour\s[MANGOS]\sdatabase\s" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                echo
                printf '%b' "Reinstall your database!"
                echo
              fi
              # can't connect to local mysql through socket
              if grep -E -q ".*Can't\sconnect\sto\slocal\sMySQL*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                echo
                printf '%b' "Can't connect to local MySQL!"
                echo
              fi
              # your mangosd.conf version indicates your conf file is out of date
              if grep -E -q ".*Your\smangosd.conf\sversion\sindicates\syour\sconf\sfile\sis\sout\sof\sdate*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                echo
                printf "\033[1;31mWARNING\033[0m "
                printf '%b' "mangosd.conf is out of date!"
                echo
              fi
              # get startup time >
              startup_time=$(grep "SERVER\sSTARTUP\sTIME*." wow/mangos-classic/run/logs/Server.log 2>/dev/null |
                cut -d\  -f6-9 2>/dev/null)
              # world initialized
              if grep -E -q "World\sinitialized" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "World initialized"
                echo
                printf '%b' "$server_log_initialized $startup_time"
                echo
              fi
              # Playerbot loaded >
              if grep -E -q "Playerbot: Using configuration file" "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "Playerbot ok"
                printf '%b' "\e[0;32mPlayerbot\033[0m"
                echo
              else
                # off >
                printf '%b' "\e[90mPlayerbot\033[0m"
                echo
              fi
              # ahbot loaded and initialized >
              if grep -E -q "Initialize AuctionHouseBot..." "$folder_core"/run/logs/Server.log 2>/dev/null; then
                # if any, print "AHbot ok"
                printf '%b' "\e[0;32mAHbot\033[0m"
                echo
              else
                # off >
                printf '%b' "\e[90mAHbot\033[0m"
                echo
              fi
            fi
            echo
            printf "\e[1;32m>\033[0m hit Any key to go back."
            echo
            read -r -n 1 -p "Server.log (tail/follow/nano) / Realmd.log (Nano) / logs (lnav)" ans
            echo
            echo
            case $ans in
            "t")
              tail "$folder_core"/run/logs/Server.log 2>/dev/null
              echo
              printf "\e[1;90m<------------------------------------------------------>\033[0m"
              echo
              read -r -p "Press Enter to continue" </dev/tty
              ;;
            "f")
              echo
              tail -f "$folder_core"/run/logs/Server.log 2>/dev/null
              ;;
            "n")
              echo
              nano "$folder_core"/run/logs/Server.log
              ;;
            "N")
              echo
              nano "$folder_core"/run/logs/Realmd.log
              ;;

              # lnav >

            "l")
              echo
              # codes >
              logs=("$folder_core"/run/logs/EventAIErrors.log
                "$folder_core"/run/logs/DBErrors.log
                "$folder_core"/run/logs/Realmd.log
                "$folder_core"/run/logs/Server.log)
              # codes done
              if ! [ -x "$(command -v lnav)" ]; then
                sudo apt install lnav -y 2>/dev/null
              fi
              lnav "${logs[@]}" 2>/dev/null
              ;;

            esac
          fi
        fi

        ;;

        # restart realmd,mangos done

        # restart realmd >

      "2")

        read -r -p "Restart realmd? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "realmd" 2>/dev/null; then
              echo "Killing screen (realmd)"
            fi
            echo "Starting server with screen
'screen -list' -> 'screen -r NUM'"
            sleep 3
            # remove dead screens
            screen -wipe 2>/dev/null
            # setup screen
            screen -dmS realmd
            # setup variable ruled by configuration
            REALMD_SCREEN="$folder_core/run/bin/./realmd -c $folder_core/run/etc/realmd.conf\n"
            # implement daemon inside newly made screens
            screen -S realmd -X -p 0 stuff "$REALMD_SCREEN"
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
            # done
            printf "\e[1;32mRestarting\033[0m realmd"
            echo
            echo "Please wait"
            sleep 1
            sudo service realmd restart &>/dev/null
            sleep 1
            echo
          fi
        fi

        ;;

        # restart realmd done

        # restart mangosd >

      "3")

        read -r -p "Restart mangosd? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then

          # this is for docker users
          if [ -f /.dockerenv ]; then
            if screen -list 2>/dev/null |
              grep -q "mangosd" 2>/dev/null; then
              echo "Killing screen (mangosd)"
            fi
            echo "Starting server with screen
'screen -list' -> 'screen -r NUM'"
            sleep 3
            # remove dead screens
            screen -wipe 2>/dev/null
            # setup screen
            screen -dmS mangosd
            # setup variables ruled by configuration
            MANGOSD_SCREEN="$folder_core/run/bin/./mangosd -c $folder_core/run/etc/mangosd.conf\n"
            # implement daemon inside newly made screens
            screen -S mangosd -X -p 0 stuff "$MANGOSD_SCREEN"
            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            cp "$folder_core"/run/logs/Realmd.log "$folder_core"/run/logs/Realmd.log.old &>/dev/null
          else

            # keep old logs >
            cp "$folder_core"/run/logs/Server.log "$folder_core"/run/logs/Server.log.old &>/dev/null
            # done
            printf "\e[1;32mRestarting\033[0m mangosd"
            echo
            sleep 1
            sudo service mangosd restart &>/dev/null
            sleep 1
            echo "Please wait"

            # wait wordlist >
            # note - don't put any space(s) between keywords.

            # mangosd >
            wordlist_mangosd=(".*[A]\sYou\shave:\s-->*.
.*[B]\sYou\sneed:\s-->*.
.*Can't\sconnect\sto\slocal\sMySQL*.
.*core\sdumped*.
.*corrupt*.
.*critical*.
.*fail*.
.*failed*.
.*fatal*.
.*file\struncated*.
.*Halting\sprocess*.
.*initialized*.
.*malformed*.
.*out\sof\sdate!*.
.*reinstall\syour*.
.*segfault*.
.*Segmentation\sfault*.
.*STARTUP*.
.*TIME*.
.*You\smust\sapply\sall\supdates\safter\s[A]\sto\s[B]*.")

            # wait wordlist done

            # wait for mangosd to fill up logs >

            # Server.log >
            tail -f "$folder_core"/run/logs/Server.log 2>/dev/null |
              { grep -q -m 1 "${wordlist_mangosd[@]}" && pkill -P $$ -x tail 2>/dev/null; }
            # wait for mangosd to fill up logs done
          fi
        fi

        ;;

        # restart mangosd done

      esac
    fi

    ;;

    # lnav - done

    # restart server done

    # update cmangos-script >

  "w")

    # codes >
    if ! [ -x "$(command -v dialog)" ]; then
      sudo apt-get install dialog -y
    fi
    # codes done
    HEIGHT=10
    WIDTH=40
    CHOICE_HEIGHT=3
    BACKTITLE="update Helper"
    TITLE="Update cmangos-script [Helper]"
    MENU="Choose one of the following options:"

    OPTIONS=(1 "Update helper"
      2 "Reinstall /cmangos-script"
      3 "Reset --hard origin/master")

    CHOICE=$(dialog --clear \
      --backtitle "$BACKTITLE" \
      --title "$TITLE" \
      --menu "$MENU" \
      $HEIGHT $WIDTH $CHOICE_HEIGHT \
      "${OPTIONS[@]}" \
      2>&1 >/dev/tty)

    clear
    case $CHOICE in

    # update helper >

    "1")

      FILE="${folder_install:?}/cmangos-script/README.md"
      if [ ! -f "$FILE" ]; then
        # not installed
        sudo chown -R "$user":"$group" "$folder_install"
        cd "$folder_install" || exit
        git clone "${github_helper:?}"
      else
        # installed
        read -r -p "Update/Install Helper? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          sudo chown -R "$user":"$group" "$folder_install"
          echo
          echo "Checking your current release"
          echo
          sleep 1
          cd "$folder_helper" || exit
          if git checkout master &>/dev/null &&
            git fetch origin master &>/dev/null &&
            [ "$(git rev-list HEAD...origin/master --count)" != 0 ] &&
            git merge origin/master; then
            latest_date=$(git log -1 --format="%at" | xargs -I{} date -d @{} '+%Y/%m/%d %H:%M:%S')
            latest_head=$(git rev-parse --short HEAD)
            printf '%b' "[\033[0;31mold\033[0m] (\e[4;32m$latest_head\033[0m) \e[4;32mNew Updates For Helper\033[0m! - $latest_date"
            echo
            cd "$folder_helper" || exit
            echo
            sleep 1
            printf "[\033[0;31mold\033[0m] -> old release installed!"
            sleep 1
            echo
            echo
            printf "[\e[1;32mUpdating Helper\033[0m]"
            echo
            echo
            # keep old mangos >
            sudo cp /usr/local/bin/mangos /usr/local/bin/mangos.old &>/dev/null
            # done
            printf "[\e[0;32mok\033[0m] -> /usr/local/bin/mangos.old"
            sleep 1
            echo
            printf "[\e[0;32mok\033[0m] -> Stripping executable on 'mangos.old'"
            sleep 1
            echo
            sudo chmod -x /usr/local/bin/mangos.old
            sudo chown -R "$user":"$group" "$folder_helper"
            cd "$folder_helper" || exit
            printf "[\e[0;32mok\033[0m] -> Installing new release"
            sleep 1
            echo
            sudo cp "$folder_helper"/mangos /usr/local/bin &>/dev/null
            sudo chmod +x /usr/local/bin/mangos
            sleep 1
            printf "[\e[0;32mok\033[0m] -> Installed."
            echo
            echo
            sleep 1 && exit
          else
            # install new upgrades >
            sudo cp /usr/local/bin/mangos /usr/local/bin/mangos.old &>/dev/null
            sudo chmod -x /usr/local/bin/mangos.old
            sudo cp "$folder_helper"/mangos /usr/local/bin/mangos &>/dev/null
            sudo chmod +x /usr/local/bin/mangos
            sleep 1
            printf "[\e[0;32mok\033[0m] -> Installed."
            echo
            echo
          fi
          # create ms folder
          sudo mkdir /var/log/ms/ 2>/dev/null
          # fix ownership
          sudo chown -R "${user:?}":"${group:?}" /var/log/ms
          # create installed mark
          echo "CMaNGOS Script was installed at ${NOW:?}" >/var/log/ms/installed_ms
          sleep 1 && exit
        fi
      fi

      ;;

      # update helper done

      # fresh install (delete/git clone /cmangos-script) >

    "2")

      read -r -p "Reinstall (delete/git clone /cmangos-script)? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        sudo mv /usr/local/bin/mangos /usr/local/bin/mangos.old &>/dev/null
        printf "[\e[0;32mok\033[0m] -> installed mangos removed."
        echo
        sudo rm -r "$folder_helper"
        printf "[\e[0;32mok\033[0m] -> cmangos-script removed."
        echo
        sudo mkdir "${folder_install:?}" &>/dev/null
        printf '%b' "[\e[0;32mok\033[0m] -> $folder_install/> git clone.."
        echo
        cd "$folder_install" || exit
        git clone "$github_helper"
        sudo cp "$folder_helper"/mangos /usr/local/bin &>/dev/null
        printf "[\e[0;32mok\033[0m] -> Installing new release"
        sudo chmod +x /usr/local/bin/mangos
        echo
        sleep 1
        printf "[\e[0;32mok\033[0m] -> Installed."
        echo
        echo
        sleep 2
        exit
      fi

      ;;

      # fresh install (delete/git clone /cmangos-script) done

      # reset --hard origin/master >

    "3")

      read -r -p "Reset --hard origin/master? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then

        cd "$folder_helper" || exit
        git reset --hard origin/master
        printf '%b' "[\e[0;32mok\033[0m] "
        read -r -p "Press Enter to continue" </dev/tty
        echo
      fi

      ;;

      # reset --hard origin/master done

      # update cmangos-script done

    esac

    ;;

    # Check logs >

  "l")

    clear

    # codes >
    # realmd.log
    realmd_log_empty="\e[0;33mEmpty\033[0m -> "
    realmd_log_error="\033[0;31mError\033[0m -> "
    realmd_log_failed="\033[0;31mRealm halted or failed\033[0m"
    realmd_log_ok="\e[0;32mok\033[0m"

    # server.log
    server_log_initialized="\e[0;32mWorld initialized\033[0m"
    server_log_serious="\033[1;31mSerious\033[0m -> "
    server_log_failed="\033[0;31mWorld halted or failed\033[0m"
    server_log_error="\033[0;31mError\033[0m -> "
    server_log_empty="\e[0;33mEmpty\033[0m -> "
    server_log_ok="\e[0;32mok\033[0m"

    # service status
    world_service=mangosd
    realm_service=realmd
    # codes done

    # realmd service
    case "$(pidof $realm_service | wc -w)" in
    0) printf "Realm [\033[1;31minactive\033[0m] " ;;
    1) printf "Realm [\e[0;32mactive\033[0m] " ;;
    *) printf "Realm [\e[0;33mok?\033[0m] " ;;
    esac

    # mangosd service
    case "$(pidof $world_service | wc -w)" in
    0) printf "World [\033[1;31minactive\033[0m] " ;;
    1) printf "World [\e[0;32mactive\033[0m] " ;;
    *) printf "World [\e[0;33mok?\033[0m] " ;;
    esac

    echo
    # realmd.log
    printf "\e[1;90m<------------------------------------------------------>\033[0m"
    echo
    # if realm failed
    if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault|file\struncated|Halting\sprocess" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
      # if any, print "Realm failed or halted"
      echo
      printf '%b' "$realmd_log_failed"
      echo
    else
      # look for empty tables
      if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        # if any, print "empty"
        printf "Server.log "
        printf '%b' "$realmd_log_empty"
        # count empty inside log
        grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Realmd.log 2>/dev/null
      fi
      # look for error
      if grep -E -q ".*ERROR*." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        # if any, print "error"
        printf "Realmd.log "
        printf '%b' "$realmd_log_error"
        # count errors inside log
        grep -c -E ".*ERROR*." "$folder_core"/run/logs/Realmd.log 2>/dev/null
      # if nothing, print "ok"
      else
        printf "Realmd.log "
        printf '%b' "$realmd_log_ok"
        echo
      fi
      # this database (realmd) is out of date!
      if grep -E -q "You\shave:\s-->" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        echo
        printf '%b' "Database is out of date!
\e[90m(d) Update Database > Apply all updates [A]-[B]\033[0m"
        echo
      fi
      # databases is missing or corrupt.
      if grep -E -q "\sdatabase\sis\smissing\sor\scorrupt." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        echo
        printf '%b' "Database is missing or corrupt!"
        echo
      fi
      # reinstall your (realmd) database
      if grep -E -q "reinstall\syour|\sUnknown\sdatabase\s|Reinstall\syour\s[REALMD]\sdatabase\s" "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        echo
        printf '%b' "Reinstall your database!"
        echo
      fi
      # your realmd.conf version indicates your conf file is out of date
      if grep -E -q ".*Your\srealmd.conf\sversion\sindicates\syour\sconf\sfile\sis\sout\sof\sdate*." "$folder_core"/run/logs/Realmd.log 2>/dev/null; then
        echo
        printf "\033[1;31mWARNING\033[0m "
        printf '%b' "realmd.conf is out of date!"
        echo
      fi
    fi
    echo
    tail "$folder_core"/run/logs/Realmd.log 2>/dev/null
    # server.log
    printf "\e[1;90m<------------------------------------------------------>\033[0m"
    echo
    # if world failed
    if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault|file\struncated|Halting\sprocess" "$folder_core"/run/logs/Server.log 2>/dev/null; then
      # if any, print "World failed or halted"
      echo
      printf '%b' "$server_log_failed"
      echo
    else
      # look for empty tables
      if grep -E -q "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "empty"
        printf "Server.log "
        printf '%b' "$server_log_empty"
        # count empty inside log
        grep -c -E "doesn't\sexist|table\s*\sis\sempty.|table\sis\sempty!|is\sempty." "$folder_core"/run/logs/Server.log 2>/dev/null
      fi
      # look for error
      if grep -E -q ".*ERROR*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "error"
        printf "Server.log "
        printf '%b' "$server_log_error"
        # count errors inside log
        grep -c -E ".*ERROR*." "$folder_core"/run/logs/Server.log 2>/dev/null
        # look for serious error
        if grep -E -q "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log 2>/dev/null; then
          # if any, print "serious"
          printf "Server.log "
          printf '%b' "$server_log_serious"
          # count serious errors inside log
          grep -c -E "malformed|fatal|critical|Segmentation\sfault|core\sdumped|segfault" "$folder_core"/run/logs/Server.log 2>/dev/null
        fi
      # if nothing, print "ok"
      else
        printf "Server.log "
        printf '%b' "$server_log_ok"
        echo
      fi
      # this database (mangosd) is out of date!
      if grep -E -q "You\shave:\s-->" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        echo
        printf '%b' "Database is out of date!
\e[90m(d) Update Database > Apply all updates [A]-[B]\033[0m"
        echo
      fi
      # databases is missing or corrupt.
      if grep -E -q "\sdatabase\sis\smissing\sor\scorrupt." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        echo
        printf '%b' "Database is missing or corrupt!"
        echo
      fi
      # reinstall your (mangosd) database
      if grep -E -q "reinstall\syour|Reinstall\syour\s[MANGOS]\sdatabase\s" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        echo
        printf '%b' "Reinstall your database!"
        echo
      fi
      # can't connect to local mysql through socket
      if grep -E -q ".*Can't\sconnect\sto\slocal\sMySQL*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        echo
        printf '%b' "Can't connect to local MySQL!"
        echo
      fi
      # your mangosd.conf version indicates your conf file is out of date
      if grep -E -q ".*Your\smangosd.conf\sversion\sindicates\syour\sconf\sfile\sis\sout\sof\sdate*." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        echo
        printf "\033[1;31mWARNING\033[0m "
        printf '%b' "mangosd.conf is out of date!"
        echo
      fi
      # get startup time >
      startup_time=$(grep "SERVER\sSTARTUP\sTIME*." wow/mangos-classic/run/logs/Server.log 2>/dev/null |
        cut -d\  -f6-9 2>/dev/null)
      # world initialized
      if grep -E -q "World\sinitialized" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "World initialized"
        echo
        printf '%b' "$server_log_initialized $startup_time"
        echo
      fi
      # Playerbot loaded >
      if grep -E -q "Playerbot: Using configuration file" "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "Playerbot ok"
        printf '%b' "\e[0;32mPlayerbot\033[0m"
        echo
      else
        # off >
        printf '%b' "\e[90mPlayerbot\033[0m"
        echo
      fi
      # ahbot loaded and initialized >
      if grep -E -q "Initialize AuctionHouseBot..." "$folder_core"/run/logs/Server.log 2>/dev/null; then
        # if any, print "AHbot ok"
        printf '%b' "\e[0;32mAHbot\033[0m"
        echo
      else
        # off >
        printf '%b' "\e[90mAHbot\033[0m"
        echo
      fi
    fi
    echo
    printf "\e[1;32m>\033[0m hit Any key to go back."
    echo
    read -r -n 1 -p "Server.log (tail/follow/nano) / Realmd.log (Nano) / logs (lnav)" ans
    echo
    echo
    case $ans in
    t | T)
      tail "$folder_core"/run/logs/Server.log 2>/dev/null
      echo
      printf "\e[1;90m<------------------------------------------------------>\033[0m"
      echo
      read -r -p "Press Enter to continue" </dev/tty
      ;;
    "f")
      echo
      tail -f "$folder_core"/run/logs/Server.log 2>/dev/null
      ;;
    "n")
      echo
      nano "$folder_core"/run/logs/Server.log 2>/dev/null
      ;;
    "N")
      echo
      nano "$folder_core"/run/logs/Realmd.log 2>/dev/null
      ;;

      # lnav >

    "l")
      echo
      # codes >
      logs=("$folder_core"/run/logs/EventAIErrors.log
        "$folder_core"/run/logs/DBErrors.log
        "$folder_core"/run/logs/Realmd.log
        "$folder_core"/run/logs/Server.log)
      # codes done
      if ! [ -x "$(command -v lnav)" ]; then
        sudo apt install lnav -y 2>/dev/null
      fi
      lnav "${logs[@]}"

      ;;

      # lnav - done

    *) ;;

    esac

    ;;

    # check logs done

    # create/apply .patch file >

  "p")

    HEIGHT=11
    WIDTH=40
    CHOICE_HEIGHT=3
    BACKTITLE="patch"
    TITLE="Patch operations"
    MENU="Choose one of the following options:"

    OPTIONS=(1 "Create new patch"
      2 "Apply existing patch"
      3 "Search for .patch files")

    CHOICE=$(dialog --clear \
      --backtitle "$BACKTITLE" \
      --title "$TITLE" \
      --menu "$MENU" \
      $HEIGHT $WIDTH $CHOICE_HEIGHT \
      "${OPTIONS[@]}" \
      2>&1 >/dev/tty)

    clear
    case $CHOICE in

    # create patch >

    "1")

      sudo chown -R "$user":"$group" "$folder_core"
      cd "$folder_core" || exit
      git checkout sql/create/db_create_mysql.sql 1>/dev/null
      git diff >"${patch:?}"

      ;;

      # create patch done

      # apply patch >

    "2")

      cd "$folder_core" || exit
      patch <"$patch" -p1

      ;;

      # apply patch done

      # search for .patch files >

    "3")

      echo "Searching for existing patches..($folder_wow)"
      echo
      sudo find "$folder_wow" -name "*.patch"
      echo
      read -r -p "Press Enter to continue" </dev/tty
      echo
      ;;
    esac

    ;;

    # search for .patch files done

    # create/apply .patch file done

    # online check >

  "o")

    # is fping installed? >
    if ! [ -x "$(command -v fping)" ]; then
      sudo apt-get install fping -y 2>/dev/null
    fi
    echo
    printf '%b' "Online check -> \e[92minternet\033[0m/\e[92mintranet\033[0m\n"
    echo
    # internet >
    if nc -z "$internet" "${realm_port:?}" 2>/dev/null; then
      PING_MS=$(fping -c 1 "$internet" 2>/dev/null |
        grep -o '[0-9].[0-9][0-9] ms' 2>/dev/null)
      PING_LOSS=$(fping -c 1 "$internet" 2>/dev/null |
        grep -o '[0-100]% loss' 2>/dev/null)
      printf '%b' "\e[0;32m✓\033[0m $internet - \e[96m$server_name\033[0m - $PING_MS - $PING_LOSS\n"
    else
      printf '%b' "\033[1;31m✗ \e[1;90m$internet - $server_name - \e[1;90m? ms - 100% loss\033[0m\n"
    fi
    # intranet >
    if nc -z "$intranet" "${realm_port:?}" 2>/dev/null; then
      PING_MS=$(fping -c 1 "$intranet" 2>/dev/null |
        grep -o '[0-9].[0-9][0-9] ms' 2>/dev/null)
      PING_LOSS=$(fping -c 1 "$intranet" 2>/dev/null |
        grep -o '[0-100]% loss' 2>/dev/null)
      printf '%b' "\e[0;32m✓\033[0m $intranet - \e[96m${server_name_lan:?}\033[0m - $PING_MS - $PING_LOSS\n"
    else
      printf '%b' "\033[1;31m✗ \e[1;90m$intranet - $server_name_lan - \e[1;90m? ms - 100% loss\033[0m\n"
    fi
    echo
    read -r -p "Press Enter to continue" </dev/tty

    ;;

    # online check done

    # edit/copy config files ? >

  "e")

    HEIGHT=19
    WIDTH=33
    CHOICE_HEIGHT=11
    BACKTITLE="Server configuration"
    TITLE="Configurations"
    MENU="Choose one of the following options:"

    OPTIONS=(1 "server.txt"
      2 "server.cnf"
      3 "mangos.conf.dist"
      4 "mangos.conf"
      5 "realmd.conf.dist"
      6 "realmd.conf"
      7 "ahbot.conf.dist"
      8 "ahbot.conf"
      9 "playerbot.conf.dist"
      10 "playerbot.conf"
      11 "InstallFullDB")

    CHOICE=$(dialog --clear \
      --backtitle "$BACKTITLE" \
      --title "$TITLE" \
      --menu "$MENU" \
      $HEIGHT $WIDTH $CHOICE_HEIGHT \
      "${OPTIONS[@]}" \
      2>&1 >/dev/tty)

    clear
    case $CHOICE in
    "1") nano "$folder_install"/server.txt ;;
    "2") nano "$folder_install"/server.cnf ;;
    "3") nano "$folder_core"/run/etc/mangosd.conf.dist ;;
    "4") nano "$folder_core"/run/etc/mangosd.conf ;;
    "5") nano "$folder_core"/run/etc/realmd.conf.dist ;;
    "6") nano "$folder_core"/run/etc/realmd.conf ;;
    "7") nano "$folder_core"/run/etc/ahbot.conf.dist ;;
    "8") nano "$folder_core"/run/etc/ahbot.conf ;;
    "9") nano "$folder_core"/run/etc/playerbot.conf.dist ;;
    "10") nano "$folder_core"/run/etc/playerbot.conf ;;
    "11") nano "$folder_db"/InstallFullDB.config ;;
    esac

    ;;

  "Q") exit ;;
  "q") echo "case sensitive!!" ;;
  *) echo "empty" ;;
  esac
done

# edit/copy config files done

# b9ea65cd1e2b40cfcbf777559ef0c9ca

# script done
